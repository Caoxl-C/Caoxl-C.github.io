<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>laravel / lumen 生命周期 | Keep It Simple And Stupid</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="keywords" content="LaravelPHPLumen" />
  
  
  
  
  <meta name="description" content="当我们在决定使用某项技术的时候，除了需要了解它能「做什么」，其实还应当研究它是「怎么做的」。">
<meta property="og:type" content="article">
<meta property="og:title" content="Laravel &#x2F; Lumen 生命周期">
<meta property="og:url" content="http://blog.caoxl.com/2018/07/06/Laravel-Lumen-Life/index.html">
<meta property="og:site_name" content="Keep It Simple And Stupid">
<meta property="og:description" content="当我们在决定使用某项技术的时候，除了需要了解它能「做什么」，其实还应当研究它是「怎么做的」。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://caoxl.com/images/laravel-life.png">
<meta property="og:image" content="https://caoxl.com/images/lumen-life.png">
<meta property="og:image" content="https://caoxl.com/images/laravel-lumen-container.png">
<meta property="article:published_time" content="2018-07-06T03:36:13.000Z">
<meta property="article:modified_time" content="2019-08-22T03:57:29.000Z">
<meta property="article:author" content="CAO XIAN LIANG">
<meta property="article:tag" content="Laravel">
<meta property="article:tag" content="PHP">
<meta property="article:tag" content="Lumen">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://caoxl.com/images/laravel-life.png">
  
    <link rel="alternate" href="/atom.xml" title="Keep It Simple And Stupid" type="application/atom+xml">
  

  

  <link rel="icon" href="https://images.unsplash.com/photo-1643801026603-63d4f50be313?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=767&q=80">
  <link rel="apple-touch-icon" href="/https://images.unsplash.com/photo-1643801026603-63d4f50be313?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=767&q=80">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
  
<link rel="stylesheet" href="/css/style.css">


  
<script src="/js/jquery-3.1.1.min.js"></script>

  
<script src="/js/bootstrap.js"></script>


  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css" >

  
    
<link rel="stylesheet" href="/css/dialog.css">

  

  

  
    <link rel="stylesheet" href="/css/header-post.css" >
  

  
  
  

<style type="text/css">
.spoiler {
  display: inline-flex;
}
p.spoiler {
  display: flex;
}
.spoiler a {
  pointer-events: none;
}
.spoiler-blur, .spoiler-blur > * {
  transition: text-shadow .5s ease;
}
.spoiler .spoiler-blur, .spoiler .spoiler-blur > * {
  color: rgba(0, 0, 0, 0);
  background-color: rgba(0, 0, 0, 0);
  text-shadow: 0 0 10px grey;
  cursor: pointer;
}
.spoiler .spoiler-blur:hover, .spoiler .spoiler-blur:hover > * {
  text-shadow: 0 0 5px grey;
}
.spoiler-box, .spoiler-box > * {
  transition: color .5s ease,
  background-color .5s ease;
}
.spoiler .spoiler-box, .spoiler .spoiler-box > * {
  color: black;
  background-color: black;
  text-shadow: none;
}</style><meta name="generator" content="Hexo 6.3.0"></head>



  <body data-spy="scroll" data-target="#toc" data-offset="50">


  
  <div id="container">
    <div id="wrap">
      
        <header>

    <div id="allheader" class="navbar navbar-default navbar-static-top" role="navigation">
        <div class="navbar-inner">
          
          <div class="container"> 
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>

            
              <a class="brand" style="
                 margin-top: 0px;"  
                href="#" data-toggle="modal" data-target="#myModal" >
                  <img width="124px" height="124px" alt="Hike News" src="https://images.unsplash.com/photo-1643801026603-63d4f50be313?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=767&q=80">
              </a>
            
            
            <div class="navbar-collapse collapse">
              <ul class="hnav navbar-nav">
                
                  <li> <a class="main-nav-link" href="/">首页</a> </li>
                
                  <li> <a class="main-nav-link" href="/archives">归档</a> </li>
                
                  <li> <a class="main-nav-link" href="/categories">分类</a> </li>
                
                  <li> <a class="main-nav-link" href="/tags">标签</a> </li>
                
                  <li> <a class="main-nav-link" href="/about">关于</a> </li>
                
                  <li><div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="请输入关键词..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(无标题)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>


</div></li>
            </div>
          </div>
                
      </div>
    </div>

</header>



      
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;"><article id="post-Laravel-Lumen-Life" style="width: 75%; float:left;" class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" class="article-title" itemprop="name">
      Laravel / Lumen 生命周期
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2018/07/06/Laravel-Lumen-Life/" class="article-date">
	  <time datetime="2018-07-06T03:36:13.000Z" itemprop="datePublished">2018-07-06</time>
	</a>

      
    <a class="article-category-link" href="/categories/Laravel-Lumen/">Laravel / Lumen</a>

      
	<a class="article-views">
	<span id="busuanzi_container_page_pv">
		阅读量<span id="busuanzi_value_page_pv"></span>
	</span>
	</a>

    </div>

    <div class="article-entry" itemprop="articleBody">
      
        
        
          <blockquote>
<p>当我们在决定使用某项技术的时候，除了需要了解它能「做什么」，其实还应当研究它是「怎么做的」。</p>
</blockquote>
<span id="more"></span>

<h1 id="Laravel-生命周期"><a href="#Laravel-生命周期" class="headerlink" title="Laravel 生命周期"></a><code>Laravel</code> 生命周期</h1><blockquote>
<p>以下所有是基于 <code>Laravel-5.6.*</code></p>
</blockquote>
<blockquote>
<p><code>Laravel</code> 的生命周期从<code>public\index.php</code>开始，从<code>public\index.php</code>结束。</p>
</blockquote>
<h2 id="生命周期始末"><a href="#生命周期始末" class="headerlink" title="生命周期始末"></a>生命周期始末</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 第一阶段</span></span><br><span class="line"><span class="keyword">require</span> <span class="keyword">__DIR__</span>.<span class="string">&#x27;/../vendor/autoload.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二阶段</span></span><br><span class="line"><span class="variable">$app</span> = reuqire_once <span class="keyword">__DIR__</span>.<span class="string">&#x27;/../bootstrap/app.php&#x27;</span>;</span><br><span class="line"><span class="variable">$kernel</span> = <span class="variable">$app</span>-&gt;<span class="title function_ invoke__">make</span>(<span class="title class_">Illuminate\Contracts\Http\Kernel</span>::<span class="variable language_">class</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第三阶段</span></span><br><span class="line"><span class="variable">$response</span> = <span class="variable">$kernel</span>-&gt;<span class="title function_ invoke__">handle</span>(</span><br><span class="line">    <span class="variable">$request</span> - <span class="title class_">Illuminate\Http\Request</span>::<span class="title function_ invoke__">capture</span>()</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发送响应</span></span><br><span class="line"><span class="variable">$response</span>-&gt;<span class="title function_ invoke__">send</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 其它</span></span><br><span class="line"><span class="variable">$kernel</span>-&gt;<span class="title function_ invoke__">terminate</span>(<span class="variable">$request</span>, <span class="variable">$response</span>);</span><br></pre></td></tr></table></figure>

<h2 id="不妨再详细一点"><a href="#不妨再详细一点" class="headerlink" title="不妨再详细一点"></a>不妨再详细一点</h2><h3 id="第一步-加载项目依赖"><a href="#第一步-加载项目依赖" class="headerlink" title="第一步: 加载项目依赖"></a>第一步: 加载项目依赖</h3><blockquote>
<p>现代 <code>PHP</code> 依赖于 <code>Composer</code> 包管理器，入口文件通过引入由 <code>Composer</code> 包管理器自动生成的类加载程序，<br>可以轻松注册并加载项目所依赖的第三方组件库。</p>
</blockquote>
<p>所有组件的加载工作，仅需一行代码即可完成:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="keyword">__DIR__</span>.<span class="string">&#x27;/../vendor/autoload.php&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="第二步-创建Laravel应用实例"><a href="#第二步-创建Laravel应用实例" class="headerlink" title="第二步: 创建Laravel应用实例"></a>第二步: 创建<code>Laravel</code>应用实例</h3><p>下面是 <code>bootstrap/app.php</code> 的代码，包含两个主要部分<code>「创建应用实例」</code>和<code>「绑定内核至 APP 服务容器」</code>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 第一部分: 创建应用实例</span></span><br><span class="line"><span class="variable">$app</span> = <span class="keyword">new</span> <span class="title class_">Illuminate\Foundation\Application</span>(</span><br><span class="line">    <span class="title function_ invoke__">realpath</span>(<span class="keyword">__DIR__</span>.<span class="string">&#x27;/../&#x27;</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二部分: 完成内核绑定</span></span><br><span class="line"><span class="variable">$app</span>-&gt;<span class="title function_ invoke__">singleton</span>(</span><br><span class="line">    <span class="title class_">Illuminate\Contracts\Http\Kernel</span>::<span class="variable language_">class</span>,</span><br><span class="line">    <span class="title class_">App\Http\Kernel</span>::<span class="variable language_">class</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="variable">$app</span>-&gt;<span class="title function_ invoke__">singleton</span>(</span><br><span class="line">    <span class="title class_">Illuminate\Contracts\Console\Kernel</span>::<span class="variable language_">class</span>,</span><br><span class="line">    <span class="title class_">App\Console\Kernel</span>::<span class="variable language_">class</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第三部分: 注册异常处理</span></span><br><span class="line"><span class="variable">$app</span>-&gt;<span class="title function_ invoke__">singleton</span>(</span><br><span class="line">    <span class="title class_">Illuminate\Contracts\Debug\ExceptionHandler</span>::<span class="variable language_">class</span>,</span><br><span class="line">    <span class="title class_">App\Exceptions\Handler</span>::<span class="variable language_">class</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="variable">$app</span>;</span><br></pre></td></tr></table></figure>

<h4 id="创建应用实例"><a href="#创建应用实例" class="headerlink" title="创建应用实例"></a>创建应用实例</h4><p>创建应用实例即实例化 <code>Illuminate\Foundation\Application</code> 这个服务容器，后续我们称其为 <code>APP 容器</code></p>
<p>在创建 <code>APP</code> 容器主要会完成: </p>
<ul>
<li>注册应用的基础路径并将路径绑定到 <code>APP</code> 容器 </li>
<li>注册基础服务提供者至 <code>APP</code> 容器 </li>
<li>注册核心容器别名至 <code>APP</code> 容器 等基础服务的注册工作。</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$basePath</span> = <span class="literal">null</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$basePath</span>) &#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">setBasePath</span>(<span class="variable">$basePath</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">registerBaseBindings</span>();</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">registerBaseServiceProviders</span>();</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">registerCoreContainerAliases</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="内核绑定"><a href="#内核绑定" class="headerlink" title="内核绑定"></a>内核绑定</h4><p><code>Laravel</code> 会依据 <code>HTTP</code> 请求的运行环境的不同，将请求发送至相应的内核: <strong>HTTP 内核</strong> 或 <strong>Console 内核。无论 HTTP 内核还是 Console 内核</strong>,<br>它们的作用都是是接收一个 <code>HTTP</code> 请求，随后返回一个响应，就是这么简单。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Http</span></span><br><span class="line"><span class="variable">$app</span>-&gt;<span class="title function_ invoke__">singleton</span>(</span><br><span class="line">    <span class="title class_">Illuminate\Contracts\Http\Kernel</span>::<span class="variable language_">class</span>,</span><br><span class="line">    <span class="title class_">App\Http\Kernel</span>::<span class="variable language_">class</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Console</span></span><br><span class="line"><span class="variable">$app</span>-&gt;<span class="title function_ invoke__">singleton</span>(</span><br><span class="line">    <span class="title class_">Illuminate\Contracts\Console\Kernel</span>::<span class="variable language_">class</span>,</span><br><span class="line">    <span class="title class_">App\Console\Kernel</span>::<span class="variable language_">class</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h5 id="认识一下两个内核"><a href="#认识一下两个内核" class="headerlink" title="认识一下两个内核"></a>认识一下两个内核</h5><p>请求被送到<code>HTTP</code>内核或<code>Console</code>内核, 这取决于进入应用的请求类型</p>
<blockquote>
<p>取决于是通过浏览器请求还是通过控制台请求, 这里我们主要通过浏览器请求.</p>
</blockquote>
<blockquote>
<p><code>HTTP</code>内核的标志性方法<code>handle</code>处理的逻辑相当简单: 获取一个 <code>Request</code>,返回一个<code>Response</code>,<br>把该内核想象作一个代表整个应用的大黑盒子, 输入<code>HTTP</code>请求, 返回<code>HTTP</code>响应.</p>
</blockquote>
<ul>
<li><code>HTTP</code></li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="variable">$bootstrappers</span> = [</span><br><span class="line">    <span class="title class_">\Illuminate\Foundation\Bootstrap\LoadEnvironmentVariables</span>::<span class="variable language_">class</span>,</span><br><span class="line">    <span class="title class_">\Illuminate\Foundation\Bootstrap\LoadConfiguration</span>::<span class="variable language_">class</span>,</span><br><span class="line">    <span class="title class_">\Illuminate\Foundation\Bootstrap\HandleExceptions</span>::<span class="variable language_">class</span>,</span><br><span class="line">    <span class="title class_">\Illuminate\Foundation\Bootstrap\RegisterFacades</span>::<span class="variable language_">class</span>,</span><br><span class="line">    <span class="title class_">\Illuminate\Foundation\Bootstrap\RegisterProviders</span>::<span class="variable language_">class</span>,</span><br><span class="line">    <span class="title class_">\Illuminate\Foundation\Bootstrap\BootProviders</span>::<span class="variable language_">class</span>,</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<ul>
<li><code>Console</code></li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="variable">$bootstrappers</span> = [</span><br><span class="line">    <span class="title class_">\Illuminate\Foundation\Bootstrap\LoadEnvironmentVariables</span>::<span class="variable language_">class</span>,</span><br><span class="line">    <span class="title class_">\Illuminate\Foundation\Bootstrap\LoadConfiguration</span>::<span class="variable language_">class</span>,</span><br><span class="line">    <span class="title class_">\Illuminate\Foundation\Bootstrap\HandleExceptions</span>::<span class="variable language_">class</span>,</span><br><span class="line">    <span class="title class_">\Illuminate\Foundation\Bootstrap\RegisterFacades</span>::<span class="variable language_">class</span>,</span><br><span class="line">    <span class="title class_">\Illuminate\Foundation\Bootstrap\SetRequestForConsole</span>::<span class="variable language_">class</span>,</span><br><span class="line">    <span class="title class_">\Illuminate\Foundation\Bootstrap\RegisterProviders</span>::<span class="variable language_">class</span>,</span><br><span class="line">    <span class="title class_">\Illuminate\Foundation\Bootstrap\BootProviders</span>::<span class="variable language_">class</span>,</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意顺序:<br><code>Facades</code> 先于 <code>ServiceProviders</code>, <code>Facades</code>也是重点,后面说.这里简单提一下,<br>注册<code>Facades</code>就是注册<code>config\app.php</code>中的<code>aliases</code>数组, 你使用的很多,如:<br><code>Auth</code>, <code>Cache</code>, <code>DB</code>等等都是<code>Facades</code>, 而<code>ServiceProviders</code>的<code>register</code>方法永远先于<br><code>boot</code>方法执行, 以免产生<code>boot</code>方法依赖某个实例而该实例还未注册的现象</p>
</blockquote>
<blockquote>
<p><code>HTTP</code>内核还定义了一系列所有请求在处理前需要经过的<code>HTTP</code>中间件, 这些中间件处理<code>HTTP</code>会话的读写、<br>判断应是否处于维护模式、验证<code>CSRF</code>令牌等等.</p>
</blockquote>
<h3 id="第三步-接收请求并响应"><a href="#第三步-接收请求并响应" class="headerlink" title="第三步: 接收请求并响应"></a>第三步: 接收请求并响应</h3><p>在完成创建 <code>APP</code> 容器后即进入了第三个阶段 「接收请求并响应」。</p>
<p><strong>「接收请求并响应」</strong> 有关代码如下:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$kernel</span> = <span class="variable">$app</span>-&gt;<span class="title function_ invoke__">make</span>(<span class="title class_">Illuminate\Contracts\Http\Kernel</span>::<span class="variable language_">class</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$response</span> = <span class="variable">$kernel</span>-&gt;<span class="title function_ invoke__">handle</span>(</span><br><span class="line">    <span class="variable">$request</span> = <span class="title class_">Illuminate\Http\Request</span>::<span class="title function_ invoke__">capture</span>()</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="variable">$response</span>-&gt;<span class="title function_ invoke__">send</span>();</span><br></pre></td></tr></table></figure>

<h4 id="解析内核实例"><a href="#解析内核实例" class="headerlink" title="解析内核实例"></a>解析内核实例</h4><p>在第二步我们已经将 <strong>HTTP 内核</strong> 和 <strong>Console 内核</strong> 绑定到了 <code>APP</code> 容器，<br>使用时通过 <code>APP</code> 容器 的 <code>make()</code> 方法将内核解析出来，解析的过程就是内核实例化的过程。</p>
<figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">$kernel</span> = <span class="built_in">$app</span>-&gt;make(Illuminate\Contracts\Http\Kernel::<span class="keyword">class</span>)<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<h5 id="内核实例化时它的内部究竟又做了哪些操作呢？"><a href="#内核实例化时它的内部究竟又做了哪些操作呢？" class="headerlink" title="内核实例化时它的内部究竟又做了哪些操作呢？"></a>内核实例化时它的内部究竟又做了哪些操作呢？</h5><p>进一步挖掘 <code>Illuminate\Foundation\Http\Kernel</code> 内核的 <code>__construct(IlluminateContractsFoundationApplication $app, \Illuminate\Routing\Router $router)</code> 构造方法,<br>它接收 <strong><code>APP</code> 容器</strong> 和 <strong>路由器</strong> 两个参数。</p>
<p>在实例化内核时，构造函数内<strong>将在 <code>HTTP</code> 内核定义的「中间件组」注册到 路由器</strong>，<br>注册完后就可以在实际处理 <code>HTTP</code> 请求前调用这些「中间件」实现 <strong>过滤</strong> 请求的目的。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">Application <span class="variable">$app</span>, Router <span class="variable">$router</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;app = <span class="variable">$app</span>;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;router = <span class="variable">$router</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$router</span>-&gt;middlewarePriority = <span class="variable language_">$this</span>-&gt;middlewarePriority;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;middlewareGroups <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$middleware</span>) &#123;</span><br><span class="line">        <span class="variable">$router</span>-&gt;<span class="title function_ invoke__">middlewareGroup</span>(<span class="variable">$key</span>, <span class="variable">$middleware</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;routeMiddleware <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$middleware</span>) &#123;</span><br><span class="line">        <span class="variable">$router</span>-&gt;<span class="title function_ invoke__">aliasMiddleware</span>(<span class="variable">$key</span>, <span class="variable">$middleware</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>middlewareGroup</code></li>
</ul>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Register a group of middleware.</span><br><span class="line"> * 注册中间件组</span><br><span class="line"> *</span><br><span class="line"> * @param  string  $name</span><br><span class="line"> * @param <span class="built_in"> array </span> $middleware</span><br><span class="line"> * @return $this</span><br><span class="line"> */<span class="keyword"></span></span><br><span class="line"><span class="keyword">public</span> function middlewareGroup($name,<span class="built_in"> array </span>$middleware)</span><br><span class="line">&#123;</span><br><span class="line">    $this-&gt;middlewareGroups[$name] = $middleware;</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> return </span>$this;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<ul>
<li><code>aliasMiddleware</code></li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Register a short-hand name for a middleware.</span></span><br><span class="line"><span class="comment"> * 注册中间件别名</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  string  $name</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  string  $class</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> $this</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">aliasMiddleware</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$class</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;middleware[<span class="variable">$name</span>] = <span class="variable">$class</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">$this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="处理HTTP请求"><a href="#处理HTTP请求" class="headerlink" title="处理HTTP请求"></a>处理<code>HTTP</code>请求</h4><blockquote>
<p>之前的所有处理，基本都是围绕在配置变量、注册服务等运行环境的构建上，构建完成后才是真刀真枪的来处理一个<code>「HTTP 请求」</code>。</p>
</blockquote>
<p>处理请求实际包含两个阶段:</p>
<ul>
<li>创建请求实例</li>
<li>处理请求</li>
</ul>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">//</span> 处理请求</span><br><span class="line"><span class="variable">$response</span> = <span class="variable">$kernel</span>-&gt;handle(</span><br><span class="line">    <span class="regexp">//</span> 创建请求实例</span><br><span class="line">    <span class="variable">$request</span> = Illuminate\Http\Request::capture();</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h5 id="创建请求实例"><a href="#创建请求实例" class="headerlink" title="创建请求实例"></a>创建请求实例</h5><p>请求实例 <code>Illuminate\Http\Request</code> 的 <code>capture()</code> 方法内部通过 <code>Symfony</code> 实例创建一个 <code>Laravel</code> 请求实例,<br>这样我们就可以获取到用户请求报文的相关信息了</p>
<figure class="highlight zephir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Create a new Illuminate HTTP request from server variables.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> static</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">capture</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">static</span>::enableHttpMethodParameterOverride();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">static</span>::createFromBase(SymfonyRequest::createFromGlobals());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Create an Illuminate request from a Symfony instance.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  \Symfony\Component\HttpFoundation\Request  $request</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> \Illuminate\Http\Request</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">createFromBase</span><span class="params">(SymfonyRequest $request)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ($request <span class="keyword">instanceof</span> <span class="keyword">static</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> $request;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $content = $request-&gt;content;</span><br><span class="line"></span><br><span class="line">    $request = (<span class="keyword">new</span> <span class="keyword">static</span>)-&gt;duplicate(</span><br><span class="line">        $request-&gt;query-&gt;all(), $request-&gt;request-&gt;all(), $request-&gt;attributes-&gt;all(),</span><br><span class="line">        $request-&gt;cookies-&gt;all(), $request-&gt;files-&gt;all(), $request-&gt;server-&gt;all()</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    $request-&gt;content = $content;</span><br><span class="line"></span><br><span class="line">    $request-&gt;request = $request-&gt;getInputSource();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> $request;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="处理请求"><a href="#处理请求" class="headerlink" title="处理请求"></a>处理请求</h5><p>请求处理发生在 <a target="_blank" rel="noopener" href="https://github.com/laravel/framework/blob/5.6/src/Illuminate/Foundation/Http/Kernel.php">HTTP</a>内核的<code>handle()</code>方法中</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Handle an incoming HTTP request.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  \Illuminate\Http\Request  $request</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> \Illuminate\Http\Response</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params"><span class="variable">$request</span></span>)</span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line"> <span class="keyword">try</span> &#123;</span><br><span class="line">     <span class="variable">$request</span>-&gt;<span class="title function_ invoke__">enableHttpMethodParameterOverride</span>();</span><br><span class="line"></span><br><span class="line">     <span class="variable">$response</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">sendRequestThroughRouter</span>(<span class="variable">$request</span>);</span><br><span class="line"> &#125; <span class="keyword">catch</span> (<span class="built_in">Exception</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">     <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">reportException</span>(<span class="variable">$e</span>);</span><br><span class="line"></span><br><span class="line">     <span class="variable">$response</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">renderException</span>(<span class="variable">$request</span>, <span class="variable">$e</span>);</span><br><span class="line"> &#125; <span class="keyword">catch</span> (<span class="built_in">Throwable</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">     <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">reportException</span>(<span class="variable">$e</span> = <span class="keyword">new</span> <span class="title class_">FatalThrowableError</span>(<span class="variable">$e</span>));</span><br><span class="line"></span><br><span class="line">     <span class="variable">$response</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">renderException</span>(<span class="variable">$request</span>, <span class="variable">$e</span>);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="variable language_">$this</span>-&gt;app[<span class="string">&#x27;events&#x27;</span>]-&gt;<span class="title function_ invoke__">dispatch</span>(</span><br><span class="line">     <span class="keyword">new</span> <span class="title class_">Events\RequestHandled</span>(<span class="variable">$request</span>, <span class="variable">$response</span>)</span><br><span class="line"> );</span><br><span class="line"></span><br><span class="line"> <span class="keyword">return</span> <span class="variable">$response</span>;</span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>

<p><strong>handle()</strong> 方法接收一个<code>HTTP</code>请求, 并最终生成一个<code>HTTP</code>响应.</p>
<p>继续深入到处理 <code>HTTP</code> 请求的方法 <strong>$this-&gt;sendRequestThroughRouter($request)</strong> 内部。</p>
<ul>
<li><code>$this-&gt;sendRequestThroughRouter($request)</code></li>
</ul>
<figure class="highlight zephir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Send the given request through the middleware / router.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  \Illuminate\Http\Request  $request</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> \Illuminate\Http\Response</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">sendRequestThroughRouter</span><span class="params">($request)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $this-&gt;app-&gt;instance(<span class="string">&#x27;request&#x27;</span>, $request);</span><br><span class="line"></span><br><span class="line">    Facade::clearResolvedInstance(<span class="string">&#x27;request&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    $this-&gt;bootstrap();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">new</span> Pipeline($this-&gt;app))</span><br><span class="line">                -&gt;send($request)</span><br><span class="line">                -&gt;through($this-&gt;app-&gt;shouldSkipMiddleware() ? [] : $this-&gt;middleware)</span><br><span class="line">                -&gt;then($this-&gt;dispatchToRouter());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将发现这段代码没有一行废话，它完成了大量的逻辑处理:</p>
<ul>
<li>首先, 将<code>$request</code>实例注册到<code>APP</code>容器供后续使用</li>
<li>之后, 清除之前<code>$request</code>实例缓存</li>
<li>然后, 启动「引导程序」</li>
<li>最后, 发送请求至路由</li>
</ul>
<h6 id="启动-「引导程序」"><a href="#启动-「引导程序」" class="headerlink" title="启动 「引导程序」"></a>启动 「引导程序」</h6><ul>
<li>下面看看:<code>$this-&gt;bootstrap();</code></li>
</ul>
<p>在 <code>$this-&gt;bootstrap();</code> 方法内部有实际调用「引导程序」，而 <code>bootstrap()</code> 实际调用的是 <code>APP</code> 容器的 <code>bootstrapWith()</code>,来看看</p>
<figure class="highlight zephir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Bootstrap the application for HTTP requests.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">bootstrap</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (! $this-&gt;app-&gt;hasBeenBootstrapped()) &#123;</span><br><span class="line">        $this-&gt;app-&gt;bootstrapWith($this-&gt;bootstrappers());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Get the bootstrap classes for the application.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> array</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">bootstrappers</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $this-&gt;bootstrappers;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最终还是要看 <code>Illuminate\Foundation\Application</code> 的 <code>bootstrapWith()</code> 方法究竟如何来启动这些引导程序的。</p>
<blockquote>
<p>这里 按 <code>CTRL + 鼠标左键</code>追踪不到, 具体位置如下</p>
</blockquote>
<ul>
<li><code>\vendor\laravel\framework\src\Illuminate\Foundation\Application.php</code></li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Run the given array of bootstrap classes.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  array  $bootstrappers</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">bootstrapWith</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$bootstrappers</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;hasBeenBootstrapped = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$bootstrappers</span> <span class="keyword">as</span> <span class="variable">$bootstrapper</span>) &#123;</span><br><span class="line">        <span class="variable language_">$this</span>[<span class="string">&#x27;events&#x27;</span>]-&gt;<span class="title function_ invoke__">fire</span>(<span class="string">&#x27;bootstrapping: &#x27;</span>.<span class="variable">$bootstrapper</span>, [<span class="variable">$this</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">make</span>(<span class="variable">$bootstrapper</span>)-&gt;<span class="title function_ invoke__">bootstrap</span>(<span class="variable">$this</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>[<span class="string">&#x27;events&#x27;</span>]-&gt;<span class="title function_ invoke__">fire</span>(<span class="string">&#x27;bootstrapped: &#x27;</span>.<span class="variable">$bootstrapper</span>, [<span class="variable">$this</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<blockquote>
<p>这里可以看到在 <code>APP</code> 容器内, 惠先解析对应的 「引导程序」 (即实例化), 随后调用 「引导程序」<br>的<code>bootstrap()</code>完成 「引导程序」来看看其内部的启动原理.</p>
</blockquote>
<h6 id="发送请求至路由"><a href="#发送请求至路由" class="headerlink" title="发送请求至路由"></a>发送请求至路由</h6><p>完成「引导程序」启动操作后，随机进入到请求处理阶段。</p>
<figure class="highlight zephir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">sendRequestThroughRouter</span><span class="params">($request)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 发送请求至路由</span></span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">new</span> Pipeline($this-&gt;app))</span><br><span class="line">                -&gt;send($request)</span><br><span class="line">                -&gt;through($this-&gt;app-&gt;shouldSkipMiddleware() ? [] : $this-&gt;middleware)</span><br><span class="line">                -&gt;then($this-&gt;dispatchToRouter());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 「发送请求至路由」这行代码中，完成了：</p>
<ul>
<li><ol>
<li>管道（pipeline）创建</li>
</ol>
</li>
<li><ol start="2">
<li>将 <code>$request</code> 传入管道</li>
</ol>
</li>
<li><ol start="3">
<li>对 <code>$request</code> 执行「中间件」处理</li>
</ol>
</li>
<li><ol start="4">
<li>实际的请求处理<br>四个不同的操作。</li>
</ol>
</li>
</ul>
<blockquote>
<p>传递给路由是通过 <code>Pipeline</code>（管道）来传递的，但是<code>Pipeline</code>有一堵墙，在传递给路由之前所有请求都要经过，<br>这堵墙定义在<code>app\Http\Kernel.php</code>中的<code>$middleware</code>数组中，没错就是中间件，<br>默认有一个<code>CheckForMaintenanceMode</code>中间件，用来检测你的网站是否暂时关闭。<br>这是一个全局中间件，所有请求都要经过，你也可以添加自己的全局中间件。</p>
</blockquote>
<p><strong>那么，究竟一个请求是如何被处理的呢？</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Get the route dispatcher callback.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> \Closure</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">dispatchToRouter</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$request</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;app-&gt;<span class="title function_ invoke__">instance</span>(<span class="string">&#x27;request&#x27;</span>, <span class="variable">$request</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;router-&gt;<span class="title function_ invoke__">dispatch</span>(<span class="variable">$request</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过 「解析内核实例」章节，可知我们已经将 <code>Illuminate\Routing\Router</code> 对象赋值给 <code>$this-&gt;router</code> 属性</p>
<p>通过 <code>router</code> 实例的 <code>disptach()</code> 方法去执行 HTTP 请求，在它的内部会完成如下处理：</p>
<ol>
<li>查找对应的路由实例</li>
<li>通过一个实例盏运行给定的路由</li>
<li>运行在<code>routes/web.php</code>配置的匹配到的控制器或匿名函数</li>
<li>返回响应结果</li>
</ol>
<p>执行 <code>$route-&gt;run()</code> 的方法定义在 <code>Illuminate\Routing\Route</code> 类中，最终执行「在 <code>routes/web.php</code> 配置的匹配到的控制器或匿名函数」:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Run the route action and return the response.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> function run()</span><br><span class="line">&#123;</span><br><span class="line">    $<span class="keyword">this</span>-&gt;container = $<span class="keyword">this</span>-&gt;container ?: new Container;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> ($<span class="keyword">this</span>-&gt;isControllerAction()) &#123;</span><br><span class="line">            <span class="keyword">return</span> $<span class="keyword">this</span>-&gt;runController();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $<span class="keyword">this</span>-&gt;runCallable();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (HttpResponseException $e) &#123;</span><br><span class="line">        <span class="keyword">return</span> $e-&gt;getResponse();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这部分如果路由的实现是一个控制器，会完成控制器实例化并执行指定方法；如果是一个匿名函数则直接调用这个匿名函数。</p>
<p>其执行结果会通过 <code>Illuminate\Routing\Router::prepareResponse($request, $response)</code> 生一个响应实例并返回。</p>
<p>至此，<code>Laravel</code> 就完成了一个 <code>HTTP</code> 请求的请求处理。</p>
<h3 id="发送响应"><a href="#发送响应" class="headerlink" title="发送响应"></a>发送响应</h3><p>发送响应由 <code>Illuminate\Http\Response</code> 父类 <code>Symfony\Component\HttpFoundation\Response</code> 中的 <code>send()</code> 方法完成</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Sends HTTP headers and content.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> $this</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">send</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">sendHeaders</span>();  <span class="comment">// 发送响应头部信息</span></span><br><span class="line">    <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">sendContent</span>();  <span class="comment">// 发送报文主题</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">function_exists</span>(<span class="string">&#x27;fastcgi_finish_request&#x27;</span>)) &#123;</span><br><span class="line">        <span class="title function_ invoke__">fastcgi_finish_request</span>();</span><br><span class="line">    &#125; <span class="keyword">elseif</span> (!\<span class="title function_ invoke__">in_array</span>(PHP_SAPI, <span class="keyword">array</span>(<span class="string">&#x27;cli&#x27;</span>, <span class="string">&#x27;phpdbg&#x27;</span>), <span class="literal">true</span>)) &#123;</span><br><span class="line">        <span class="built_in">static</span>::<span class="title function_ invoke__">closeOutputBuffers</span>(<span class="number">0</span>, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">$this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="终止程序"><a href="#终止程序" class="headerlink" title="终止程序"></a>终止程序</h3><blockquote>
<p>程序终止, 完成终止中间件的调用</p>
</blockquote>
<ul>
<li><code>Illuminate\Foundation\Http\Kernel.php</code></li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Call the terminate method on any terminable middleware.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  \Illuminate\Http\Request  $request</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  \Illuminate\Http\Response  $response</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">terminate</span>(<span class="params"><span class="variable">$request</span>, <span class="variable">$response</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">terminateMiddleware</span>(<span class="variable">$request</span>, <span class="variable">$response</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">$this</span>-&gt;app-&gt;<span class="title function_ invoke__">terminate</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Call the terminate method on any terminable middleware.</span></span><br><span class="line"><span class="comment"> * 终止中间件</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  \Illuminate\Http\Request  $request</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  \Illuminate\Http\Response  $response</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">terminateMiddleware</span>(<span class="params"><span class="variable">$request</span>, <span class="variable">$response</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$middlewares</span> = <span class="variable language_">$this</span>-&gt;app-&gt;<span class="title function_ invoke__">shouldSkipMiddleware</span>() ? [] : <span class="title function_ invoke__">array_merge</span>(</span><br><span class="line">        <span class="variable">$this</span>-&gt;<span class="title function_ invoke__">gatherRouteMiddleware</span>(<span class="variable">$request</span>),</span><br><span class="line">        <span class="variable">$this</span>-&gt;middleware</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$middlewares</span> <span class="keyword">as</span> <span class="variable">$middleware</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (! <span class="title function_ invoke__">is_string</span>(<span class="variable">$middleware</span>)) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">list</span>(<span class="variable">$name</span>) = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">parseMiddleware</span>(<span class="variable">$middleware</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$instance</span> = <span class="variable language_">$this</span>-&gt;app-&gt;<span class="title function_ invoke__">make</span>(<span class="variable">$name</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">method_exists</span>(<span class="variable">$instance</span>, <span class="string">&#x27;terminate&#x27;</span>)) &#123;</span><br><span class="line">            <span class="variable">$instance</span>-&gt;<span class="title function_ invoke__">terminate</span>(<span class="variable">$request</span>, <span class="variable">$response</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p><img src="https://caoxl.com/images/laravel-life.png" alt="Laravel生命周期"></p>
<blockquote>
<p>在 「创建 Laravel 应用实例」时不仅会注册项目基础服务、注册项目服务提供者别名、注册目录路径等在内的一系列注册工作；<br>还会绑定 HTTP 内核及 Console 内核到 APP 容器， 同时在 HTTP 内核里配置中间件和引导程序。</p>
<p>进入 「接收请求并响应」里，会依据运行环境从 <code>APP</code> 容器 解析出 <code>HTTP</code> 内核或 <code>Console</code> 内核。<br>如果是 <code>HTTP</code> 内核，还将把「中间件」及「引导程序」注册到 <code>APP</code> 容器。</p>
<p>所有初始化工作完成后便进入「处理 <code>HTTP</code> 请求」阶段。</p>
<p>一个 <code>Http</code> 请求实例会被注册到 <code>APP</code> 容器，通过启动「引导程序」来设置环境变量、加载配置文件等等系统环境配置;</p>
<p>随后请求被分发到匹配的路由，在路由中执行「中间件」以过滤不满足校验规则的请求，<br>只有通过「中间件」处理的请求才最终处理实际的控制器或匿名函数生成响应结果。</p>
<p>最后发送响应给用户，清理项目中的中间件，完成一个 「请求」 - 「响应」 的生命周期，之后我们的 <code>Web</code> 服务器将等待下一轮用户请求。</p>
</blockquote>
<h1 id="Lumen-生命周期"><a href="#Lumen-生命周期" class="headerlink" title="Lumen 生命周期"></a><code>Lumen</code> 生命周期</h1><blockquote>
<p><code>Lumen</code> 被称为简洁版 <code>Laravel</code>, 但是还是有很多差异的!</p>
</blockquote>
<h2 id="程序入口-public-index-php"><a href="#程序入口-public-index-php" class="headerlink" title="程序入口 public/index.php"></a>程序入口 <code>public/index.php</code></h2><ul>
<li>加载<code>bootstrap/app.php</code></li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$app</span> = <span class="keyword">require</span> <span class="keyword">__DIR__</span>.<span class="string">&#x27;/../bootstrap/app.php&#x27;</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>执行容器的<code>run()</code></li>
</ul>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$app</span>-&gt;<span class="built_in">run</span>();</span><br></pre></td></tr></table></figure>

<h2 id="bootstrap-app-php中的操作"><a href="#bootstrap-app-php中的操作" class="headerlink" title="bootstrap/app.php中的操作"></a><code>bootstrap/app.php</code>中的操作</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require_once</span> <span class="keyword">__DIR__</span>.<span class="string">&#x27;/../vendor/autoload.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    (<span class="keyword">new</span> <span class="title class_">Dotenv\Dotenv</span>(<span class="keyword">__DIR__</span>.<span class="string">&#x27;/../&#x27;</span>))-&gt;<span class="title function_ invoke__">load</span>();</span><br><span class="line">&#125; <span class="keyword">catch</span> (Dotenv\<span class="built_in">Exception</span>\InvalidPathException <span class="variable">$e</span>) &#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$app</span> = <span class="keyword">new</span> <span class="title class_">Laravel\Lumen\Application</span>(</span><br><span class="line">    <span class="title function_ invoke__">realpath</span>(<span class="keyword">__DIR__</span>.<span class="string">&#x27;/../&#x27;</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="variable">$app</span>-&gt;<span class="title function_ invoke__">withFacades</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$app</span>-&gt;<span class="title function_ invoke__">withEloquent</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$app</span>-&gt;<span class="title function_ invoke__">singleton</span>(</span><br><span class="line">    <span class="title class_">Illuminate\Contracts\Debug\ExceptionHandler</span>::<span class="variable language_">class</span>,</span><br><span class="line">    <span class="title class_">App\Exceptions\Handler</span>::<span class="variable language_">class</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="variable">$app</span>-&gt;<span class="title function_ invoke__">singleton</span>(</span><br><span class="line">    <span class="title class_">Illuminate\Contracts\Console\Kernel</span>::<span class="variable language_">class</span>,</span><br><span class="line">    <span class="title class_">App\Console\Kernel</span>::<span class="variable language_">class</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="variable">$app</span>-&gt;<span class="title function_ invoke__">middleware</span>([</span><br><span class="line">   <span class="title class_">App\Http\Middleware\ExampleMiddleware</span>::<span class="variable language_">class</span></span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="variable">$app</span>-&gt;<span class="title function_ invoke__">routeMiddleware</span>([</span><br><span class="line">    <span class="string">&#x27;auth&#x27;</span> =&gt; <span class="title class_">App\Http\Middleware\Authenticate</span>::<span class="variable language_">class</span>,</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="variable">$app</span>-&gt;<span class="title function_ invoke__">register</span>(<span class="title class_">App\Providers\AppServiceProvider</span>::<span class="variable language_">class</span>);</span><br><span class="line"><span class="variable">$app</span>-&gt;<span class="title function_ invoke__">register</span>(<span class="title class_">App\Providers\AuthServiceProvider</span>::<span class="variable language_">class</span>);</span><br><span class="line"><span class="variable">$app</span>-&gt;<span class="title function_ invoke__">register</span>(<span class="title class_">App\Providers\EventServiceProvider</span>::<span class="variable language_">class</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$app</span>-&gt;router-&gt;<span class="title function_ invoke__">group</span>([</span><br><span class="line">    <span class="string">&#x27;namespace&#x27;</span> =&gt; <span class="string">&#x27;App\Http\Controllers&#x27;</span>,</span><br><span class="line">], function (<span class="variable">$router</span>) &#123;</span><br><span class="line">    <span class="keyword">require</span> <span class="keyword">__DIR__</span>.<span class="string">&#x27;/../routes/web.php&#x27;</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="variable">$app</span>;</span><br></pre></td></tr></table></figure>

<p><strong>说明:</strong></p>
<ul>
<li><code>require_once __DIR__.&#39;/../vendor/autoload.php;</code></li>
</ul>
<blockquote>
<p>加载<code>vendor</code>目录自动加载文件; 这是<code>composer</code>默认自动加载文件</p>
</blockquote>
<ul>
<li><code>()new Dotnev\Dotenv(__DIR__.&#39;/../))-&gt;load();</code></li>
</ul>
<blockquote>
<p>加载<code>.env</code>配置; <code>Lumen</code>采用<code>.env</code>接管配置, 此处进行配置加载</p>
</blockquote>
<ul>
<li><code>$app = new Laravel\Lumen\Application();</code></li>
</ul>
<blockquote>
<p>生成容器<code>$app</code>; 其实<code>Laravel/Lumen</code>的核心就是容器, 再看<code>Application</code>源码也是继承了<code>Container</code></p>
</blockquote>
<ul>
<li><code>$app-&gt;withFacades();</code></li>
</ul>
<blockquote>
<p>启用<code>Facades</code>特性; <code>Lumen</code>默认是禁用了<code>Facades</code>特性, 取消注释则启用.</p>
</blockquote>
<ul>
<li><code>$app-&gt;withEloquent();</code></li>
</ul>
<blockquote>
<p>启用<code>Eloquent</code>特性; <code>Lumen</code>默认禁用了<code>Eloquent</code>的<code>ORM</code>支持, **作者说是给用户自行选择不同<code>ORM</code>的权利</p>
</blockquote>
<ul>
<li><code>$app-&gt;configure(&#39;app&#39;);</code></li>
</ul>
<blockquote>
<p>加载配置文件; 如果有自定义的配置文件, 则需要在此进行加载.</p>
</blockquote>
<ul>
<li><code>$app-&gt;singleton();</code></li>
</ul>
<blockquote>
<p>注册容器绑定; 看过源码<code>singleton</code>和<code>bind</code>的区别就是前者内部调用了<code>bind</code>, 且第三个参数设为<code>true</code>, 意思是共享、独一的对象，也就是单例模式.</p>
</blockquote>
<ul>
<li><code>$app-&gt;middleware();</code></li>
</ul>
<blockquote>
<p>注册中间件; 根据需要添加或去除注释启用</p>
</blockquote>
<ul>
<li><code>$app-&gt;register(App\Providers\LogServiceProvider::class);</code></li>
</ul>
<blockquote>
<p>注册<code>ServiceProvider</code>; <code>Laravel</code>&#x2F;<code>Lumen</code>的很大一部分特性是依赖<code>ServiceProvider</code>实现的</p>
</blockquote>
<ul>
<li><code>$app-&gt;group();</code></li>
</ul>
<blockquote>
<p>加载路由文件; 这里可以再跟下<code>group()</code>的实现, 在<code>vendor/laravel/lumen-framework/src/Routing/Router.php</code></p>
</blockquote>
<ul>
<li><code>return $app;</code></li>
</ul>
<blockquote>
<p>返回容器<code>$app</code></p>
</blockquote>
<p><img src="https://caoxl.com/images/lumen-life.png" alt="Lumen生命周期"></p>
<h2 id="Laravel-Lumen-容器"><a href="#Laravel-Lumen-容器" class="headerlink" title="Laravel/Lumen 容器"></a><code>Laravel/Lumen</code> 容器</h2><p><img src="https://caoxl.com/images/laravel-lumen-container.png" alt="Laravel/Lumen容器"></p>
<h3 id="Facades模式"><a href="#Facades模式" class="headerlink" title="Facades模式"></a><code>Facades</code>模式</h3><blockquote>
<p>中文译名: 外观模式、门面模式<br>主要特性: 屏蔽内部实现, 开发接口供外部使用, 提高模块抽离</p>
</blockquote>
<p><code>Laravel</code>的<code>Facades</code>也是在框架级提供抽象调用, 从而是开发者无需关心内容实现.</p>
<p><strong>Facades的理解:</strong></p>
<ol>
<li>别名, 首先通过<code>class_alias</code>将<code>DB</code>、<code>Log</code>、<code>Cache</code>等关键词映射为不同的<code>Facades</code>类</li>
</ol>
<figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span><span class="number">_</span><span class="keyword">alias</span>(<span class="string">&#x27;Illuminate\Support\Facades\Cache&#x27;</span>, <span class="string">&#x27;Cache&#x27;</span>);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>不同<code>Facades</code>子类返回容器内注册服务的关键词<code>db</code>、<code>log</code>、<code>cache</code>等</li>
</ol>
<blockquote>
<p><code>vendor/illuminate/support/Facades/</code></p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cache</span> <span class="keyword">extends</span> <span class="title">Facade</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Get the registered name of the component.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getFacadeAccessor</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;cache&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>通过绑定函数,向容器注册或绑定<code>ServiceProvider</code></li>
</ol>
<blockquote>
<p><code>/vendor/laravel/lumen-framework/src/Application.php</code></p>
</blockquote>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">function</span> <span class="title function_">registerCacheBindings</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    $<span class="keyword">this</span>-&gt;singleton(<span class="string">&#x27;cache&#x27;</span>, <span class="keyword">function</span> <span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> $<span class="keyword">this</span>-&gt;loadComponent(<span class="string">&#x27;cache&#x27;</span>, <span class="string">&#x27;Illuminate\Cache\CacheServiceProvider&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    $<span class="keyword">this</span>-&gt;singleton(<span class="string">&#x27;cache.store&#x27;</span>, <span class="keyword">function</span> <span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> $<span class="keyword">this</span>-&gt;loadComponent(<span class="string">&#x27;cache&#x27;</span>, <span class="string">&#x27;Illuminate\Cache\CacheServiceProvider&#x27;</span>, <span class="string">&#x27;cache.store&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Facades</code>主要依赖<code>Service Container</code>和<code>Service Provider</code>实现</p>
<blockquote>
<p>推荐一篇文章对容器介绍很全面: <a target="_blank" rel="noopener" href="https://www.insp.top/article/learn-laravel-container">laravel 学习笔记 —— 神奇的服务容器</a></p>
</blockquote>
<h3 id="Service-Container"><a href="#Service-Container" class="headerlink" title="Service Container"></a><code>Service Container</code></h3><p>其实就是<code>$app</code>, 它是全局的一个容器，是<code>Lumen</code>的核心。</p>
<blockquote>
<p>容器(<code>Service Container</code>)实现: <code>vendor/laravel/lumen-framework/src/Application.php</code></p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Application</span> <span class="keyword">extends</span> <span class="title">Container</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">Concerns</span>\<span class="title">RoutesRequests</span>,</span><br><span class="line">        <span class="title">Concerns</span>\<span class="title">RegistersExceptionHandlers</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">register</span>(<span class="params"><span class="variable">$provider</span></span>) </span>&#123;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">make</span>(<span class="params"><span class="variable">$abstract</span>, <span class="keyword">array</span> <span class="variable">$parameters</span> = []</span>) </span>&#123;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">configure</span>(<span class="params"><span class="variable">$name</span></span>) </span>&#123;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">withFacades</span>(<span class="params"><span class="variable">$aliases</span> = <span class="literal">true</span>, <span class="variable">$userAliases</span> = []</span>) </span>&#123;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">withAliases</span>(<span class="params"><span class="variable">$userAliases</span> = []</span>) </span>&#123;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">withEloquent</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">registerCacheBindings</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">registerDatabaseBindings</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">registerEncrypterBindings</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">registerLogBindings</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// 各种`Service Provider`的绑定</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Service-Provider"><a href="#Service-Provider" class="headerlink" title="Service Provider"></a><code>Service Provider</code></h3><p>向容器提供不同的服务, 通过<code>register</code>函数向容器中注入类实例, 从而实现<code>DI</code>(依赖注入), 是一种<code>IOC</code>的实现方式, 不同服务的<code>ServiceProvider</code>分布在不同额服务子目录下</p>
<p>不同服务的<code>ServiceProvider</code>分布在不同的服务子目录下:</p>
<ul>
<li><p><code>cache: vendor/illuminate/cache/CacheServiceProviders.php</code></p>
</li>
<li><p><code>db: vendor/illuminate/database/DatabaseServiceProvider.php</code></p>
</li>
<li><p><code>queue: vendor/illminate/queue/QueueServiceProvider.php</code></p>
</li>
<li><p>不同的<code>ServiceProvider</code>都继承<code>ServiceProvider</code></p>
</li>
<li><p>重写<code>register()</code>方法</p>
</li>
<li><p><code>$defer</code>变量表征是否延迟加载</p>
</li>
<li><p><code>providers()</code>方法返回该<code>ServiceProvider</code>可向容器提供的所有服务列表</p>
</li>
</ul>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000014598466">深度挖掘 Laravel 生命周期</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/08b810b720d9">Laravel 的生命周期</a>– 该<code>Laravel</code>版本较低</li>
<li><a target="_blank" rel="noopener" href="https://www.insp.top/article/learn-laravel-container">laravel 学习笔记 —— 神奇的服务容器</a></li>
</ul>

        
      
    </div>

    <footer class="article-footer">
      
      
      <div>
        <ul class="post-copyright">
          <li class="post-copyright-author">
          <strong>本文作者:  </strong>CAO XIAN LIANG</a>
          </li>
          <li class="post-copyright-link">
          <strong>本文链接:  </strong>
          <a href="/2018/07/06/Laravel-Lumen-Life/" target="_blank" title="Laravel / Lumen 生命周期">http://blog.caoxl.com/2018/07/06/Laravel-Lumen-Life/</a>
          </li>
          <li class="post-copyright-license">
            <strong>版权声明:   </strong>
            本博客所有文章除特别声明外，均采用 <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">CC BY-NC-ND 4.0</a>
            许可协议。转载请注明出处
          </li>
         
        </ul>
<div>

      
      
      
      
        
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Laravel/" rel="tag">Laravel</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Lumen/" rel="tag">Lumen</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PHP/" rel="tag">PHP</a></li></ul>

      

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/07/09/Technical-Specigications/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">上一篇</strong>
      <div class="article-nav-title">
        
          技术 / 团队规范
        
      </div>
    </a>
  
  
    <a href="/2018/07/06/PHP-life/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <div class="article-nav-title">PHP 生命周期</div>
    </a>
  
</nav>

  
</article>

<!-- Table of Contents -->

  <aside id="toc-sidebar">
    <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Laravel-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="nav-number">1.</span> <span class="nav-text">Laravel 生命周期</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%A7%8B%E6%9C%AB"><span class="nav-number">1.1.</span> <span class="nav-text">生命周期始末</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%8D%E5%A6%A8%E5%86%8D%E8%AF%A6%E7%BB%86%E4%B8%80%E7%82%B9"><span class="nav-number">1.2.</span> <span class="nav-text">不妨再详细一点</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E6%AD%A5-%E5%8A%A0%E8%BD%BD%E9%A1%B9%E7%9B%AE%E4%BE%9D%E8%B5%96"><span class="nav-number">1.2.1.</span> <span class="nav-text">第一步: 加载项目依赖</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC%E4%BA%8C%E6%AD%A5-%E5%88%9B%E5%BB%BALaravel%E5%BA%94%E7%94%A8%E5%AE%9E%E4%BE%8B"><span class="nav-number">1.2.2.</span> <span class="nav-text">第二步: 创建Laravel应用实例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%BA%94%E7%94%A8%E5%AE%9E%E4%BE%8B"><span class="nav-number">1.2.2.1.</span> <span class="nav-text">创建应用实例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%86%85%E6%A0%B8%E7%BB%91%E5%AE%9A"><span class="nav-number">1.2.2.2.</span> <span class="nav-text">内核绑定</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%AE%A4%E8%AF%86%E4%B8%80%E4%B8%8B%E4%B8%A4%E4%B8%AA%E5%86%85%E6%A0%B8"><span class="nav-number">1.2.2.2.1.</span> <span class="nav-text">认识一下两个内核</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC%E4%B8%89%E6%AD%A5-%E6%8E%A5%E6%94%B6%E8%AF%B7%E6%B1%82%E5%B9%B6%E5%93%8D%E5%BA%94"><span class="nav-number">1.2.3.</span> <span class="nav-text">第三步: 接收请求并响应</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90%E5%86%85%E6%A0%B8%E5%AE%9E%E4%BE%8B"><span class="nav-number">1.2.3.1.</span> <span class="nav-text">解析内核实例</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%86%85%E6%A0%B8%E5%AE%9E%E4%BE%8B%E5%8C%96%E6%97%B6%E5%AE%83%E7%9A%84%E5%86%85%E9%83%A8%E7%A9%B6%E7%AB%9F%E5%8F%88%E5%81%9A%E4%BA%86%E5%93%AA%E4%BA%9B%E6%93%8D%E4%BD%9C%E5%91%A2%EF%BC%9F"><span class="nav-number">1.2.3.1.1.</span> <span class="nav-text">内核实例化时它的内部究竟又做了哪些操作呢？</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%84%E7%90%86HTTP%E8%AF%B7%E6%B1%82"><span class="nav-number">1.2.3.2.</span> <span class="nav-text">处理HTTP请求</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E8%AF%B7%E6%B1%82%E5%AE%9E%E4%BE%8B"><span class="nav-number">1.2.3.2.1.</span> <span class="nav-text">创建请求实例</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82"><span class="nav-number">1.2.3.2.2.</span> <span class="nav-text">处理请求</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8-%E3%80%8C%E5%BC%95%E5%AF%BC%E7%A8%8B%E5%BA%8F%E3%80%8D"><span class="nav-number">1.2.3.2.2.1.</span> <span class="nav-text">启动 「引导程序」</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%8F%91%E9%80%81%E8%AF%B7%E6%B1%82%E8%87%B3%E8%B7%AF%E7%94%B1"><span class="nav-number">1.2.3.2.2.2.</span> <span class="nav-text">发送请求至路由</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%91%E9%80%81%E5%93%8D%E5%BA%94"><span class="nav-number">1.2.4.</span> <span class="nav-text">发送响应</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%88%E6%AD%A2%E7%A8%8B%E5%BA%8F"><span class="nav-number">1.2.5.</span> <span class="nav-text">终止程序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">1.2.6.</span> <span class="nav-text">总结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Lumen-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="nav-number">2.</span> <span class="nav-text">Lumen 生命周期</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A8%8B%E5%BA%8F%E5%85%A5%E5%8F%A3-public-index-php"><span class="nav-number">2.1.</span> <span class="nav-text">程序入口 public&#x2F;index.php</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#bootstrap-app-php%E4%B8%AD%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="nav-number">2.2.</span> <span class="nav-text">bootstrap&#x2F;app.php中的操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Laravel-Lumen-%E5%AE%B9%E5%99%A8"><span class="nav-number">2.3.</span> <span class="nav-text">Laravel&#x2F;Lumen 容器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Facades%E6%A8%A1%E5%BC%8F"><span class="nav-number">2.3.1.</span> <span class="nav-text">Facades模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Service-Container"><span class="nav-number">2.3.2.</span> <span class="nav-text">Service Container</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Service-Provider"><span class="nav-number">2.3.3.</span> <span class="nav-text">Service Provider</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-number">3.</span> <span class="nav-text">参考</span></a></li></ol>
    
    </div>
  </aside>

</section>
        
      </div>
      
      <footer id="footer">
  

  <div class="container">
      	<div class="row">
	      <p> Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/iTimeTraveler/hexo-theme-hiker" target="_blank">Hexo-theme-hiker</a> </p>
	      <p id="copyRightEn">Copyright &copy; 2017 - 2023 Keep It Simple And Stupid All Rights Reserved.</p>
	      
	      
    		<p class="busuanzi_uv">
				访客数 : <span id="busuanzi_value_site_uv"></span> |  
				访问量 : <span id="busuanzi_value_site_pv"></span>
		    </p>
  		   
		</div>

		
  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");
    var allheader = document.getElementById("allheader");

    wrapdiv.style.minHeight = document.body.offsetHeight + "px";
    if (allheader != null) {
      contentdiv.style.minHeight = document.body.offsetHeight - allheader.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    } else {
      contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    }
</script>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/categories" class="mobile-nav-link">Categories</a>
  
    <a href="/tags" class="mobile-nav-link">Tags</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav> -->
    

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>




<script src="/js/scripts.js"></script>





  
<script src="/js/dialog.js"></script>









	<div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>



	<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
	</script>






  </div>

  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="myModalLabel">设置</h2>
      </div>
      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">


      <div class="modal-body">
          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" onclick="javascript:setFontSize();" aria-expanded="true" aria-controls="collapseOne">
              正文字号大小
            </a>
          </div>
          <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
          <div class="panel-body">
            您已调整页面字体大小
          </div>
        </div>
      


          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" onclick="javascript:setBackground();" aria-expanded="true" aria-controls="collapseTwo">
              夜间护眼模式
            </a>
        </div>
          <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
          <div class="panel-body">
            夜间模式已经开启，再次单击按钮即可关闭 
          </div>
        </div>

        <div>
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="true" aria-controls="collapseThree">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;关 于&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
        </div>
         <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
          <div class="panel-body">
            Keep It Simple And Stupid
          </div>
          <div class="panel-body">
            Copyright © 2023 CAO XIAN LIANG All Rights Reserved.
          </div>
        </div>
      </div>


      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <div class="modal-footer">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
      </div>
    </div>
  </div>
</div>
  
  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
  
    <a id="menu-switch"><i class="fa fa-bars fa-lg"></i></a>
  
</body>
</html>