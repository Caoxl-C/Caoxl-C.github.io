<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>laravel 基础知识 | Keep It Simple And Stupid</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="keywords" content="LaravelFrameworkPHP" />
  
  
  
  
  <meta name="description" content="记录Laravel的一些基础知识…  原文地址: Head into Laravel">
<meta property="og:type" content="article">
<meta property="og:title" content="Laravel 基础知识">
<meta property="og:url" content="http://blog.caoxl.com/2018/01/16/Laravel-Basic-knowledge/index.html">
<meta property="og:site_name" content="Keep It Simple And Stupid">
<meta property="og:description" content="记录Laravel的一些基础知识…  原文地址: Head into Laravel">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2018-01-16T07:06:24.000Z">
<meta property="article:modified_time" content="2019-08-22T03:58:56.000Z">
<meta property="article:author" content="CAO XIAN LIANG">
<meta property="article:tag" content="Laravel">
<meta property="article:tag" content="Framework">
<meta property="article:tag" content="PHP">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Keep It Simple And Stupid" type="application/atom+xml">
  

  

  <link rel="icon" href="https://images.unsplash.com/photo-1643801026603-63d4f50be313?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=767&q=80">
  <link rel="apple-touch-icon" href="/https://images.unsplash.com/photo-1643801026603-63d4f50be313?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=767&q=80">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
  
<link rel="stylesheet" href="/css/style.css">


  
<script src="/js/jquery-3.1.1.min.js"></script>

  
<script src="/js/bootstrap.js"></script>


  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css" >

  
    
<link rel="stylesheet" href="/css/dialog.css">

  

  

  
    <link rel="stylesheet" href="/css/header-post.css" >
  

  
  
  

<style type="text/css">
.spoiler {
  display: inline-flex;
}
p.spoiler {
  display: flex;
}
.spoiler a {
  pointer-events: none;
}
.spoiler-blur, .spoiler-blur > * {
  transition: text-shadow .5s ease;
}
.spoiler .spoiler-blur, .spoiler .spoiler-blur > * {
  color: rgba(0, 0, 0, 0);
  background-color: rgba(0, 0, 0, 0);
  text-shadow: 0 0 10px grey;
  cursor: pointer;
}
.spoiler .spoiler-blur:hover, .spoiler .spoiler-blur:hover > * {
  text-shadow: 0 0 5px grey;
}
.spoiler-box, .spoiler-box > * {
  transition: color .5s ease,
  background-color .5s ease;
}
.spoiler .spoiler-box, .spoiler .spoiler-box > * {
  color: black;
  background-color: black;
  text-shadow: none;
}</style><meta name="generator" content="Hexo 6.3.0"></head>



  <body data-spy="scroll" data-target="#toc" data-offset="50">


  
  <div id="container">
    <div id="wrap">
      
        <header>

    <div id="allheader" class="navbar navbar-default navbar-static-top" role="navigation">
        <div class="navbar-inner">
          
          <div class="container"> 
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>

            
              <a class="brand" style="
                 margin-top: 0px;"  
                href="#" data-toggle="modal" data-target="#myModal" >
                  <img width="124px" height="124px" alt="Hike News" src="https://images.unsplash.com/photo-1643801026603-63d4f50be313?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=767&q=80">
              </a>
            
            
            <div class="navbar-collapse collapse">
              <ul class="hnav navbar-nav">
                
                  <li> <a class="main-nav-link" href="/">首页</a> </li>
                
                  <li> <a class="main-nav-link" href="/archives">归档</a> </li>
                
                  <li> <a class="main-nav-link" href="/categories">分类</a> </li>
                
                  <li> <a class="main-nav-link" href="/tags">标签</a> </li>
                
                  <li> <a class="main-nav-link" href="/about">关于</a> </li>
                
                  <li><div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="请输入关键词..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(无标题)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>


</div></li>
            </div>
          </div>
                
      </div>
    </div>

</header>



      
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;"><article id="post-Laravel-Basic-knowledge" style="width: 75%; float:left;" class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" class="article-title" itemprop="name">
      Laravel 基础知识
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2018/01/16/Laravel-Basic-knowledge/" class="article-date">
	  <time datetime="2018-01-16T07:06:24.000Z" itemprop="datePublished">2018-01-16</time>
	</a>

      
    <a class="article-category-link" href="/categories/Laravel-Lumen/">Laravel / Lumen</a>

      
	<a class="article-views">
	<span id="busuanzi_container_page_pv">
		阅读量<span id="busuanzi_value_page_pv"></span>
	</span>
	</a>

    </div>

    <div class="article-entry" itemprop="articleBody">
      
        
        
          <blockquote>
<p>记录Laravel的一些基础知识…</p>
<blockquote>
<p>原文地址: <a target="_blank" rel="noopener" href="http://blog.cjli.info/2016/08/19/Head-Into-Laravel/">Head into Laravel</a></p>
</blockquote>
</blockquote>
<span id="more"></span>


<h1 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h1><h2 id="全局安装-Composer"><a href="#全局安装-Composer" class="headerlink" title="全局安装 Composer"></a>全局安装 <code>Composer</code></h2><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">curl -sS https:<span class="string">//getcomposer.org/installer</span> | php -- <span class="params">--install-dir=bin</span> <span class="params">--filename=composer</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Or</span></span><br><span class="line"><span class="comment"># php -r &quot;readfile(&#x27;https://getcomposer.org/installer&#x27;);&quot; | php</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Or manually rename composer.phar to composer and link the composer binary file to $PATH</span></span><br></pre></td></tr></table></figure>

<h2 id="安装-Laravel-x2F-Lumen"><a href="#安装-Laravel-x2F-Lumen" class="headerlink" title="安装 Laravel&#x2F;Lumen"></a>安装 <code>Laravel</code>&#x2F;<code>Lumen</code></h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">composer <span class="keyword">global</span> <span class="keyword">require</span> laravel/installer</span><br><span class="line">composer <span class="keyword">global</span> <span class="keyword">require</span> <span class="string">&quot;laravel/lumen-installer=~1.0&quot;</span></span><br><span class="line"></span><br><span class="line">vim ~/.zshrc</span><br><span class="line"></span><br><span class="line"><span class="comment"># add `~/.composer/vendor/bin` to the $PATH</span></span><br><span class="line"></span><br><span class="line">source ~/.zshrc</span><br></pre></td></tr></table></figure>

<h2 id="自带服务器运行"><a href="#自带服务器运行" class="headerlink" title="自带服务器运行"></a>自带服务器运行</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">laravel <span class="keyword">new</span> site</span><br><span class="line"><span class="comment"># or Lumen: `lumen new site`</span></span><br><span class="line"></span><br><span class="line">cd site</span><br><span class="line">php artisan serve --port <span class="number">8888</span></span><br></pre></td></tr></table></figure>

<h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><ul>
<li>安装指定版本的 <code>Laravel/Lumen</code></li>
</ul>
<figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">composer</span> <span class="built_in">create-project</span> <span class="string">laravel</span>/<span class="string">laravel</span> <span class="string">blog</span> <span class="string">&quot;5.1.*&quot;</span></span><br></pre></td></tr></table></figure>

<h1 id="Blade"><a href="#Blade" class="headerlink" title="Blade"></a>Blade</h1><h2 id="布局视图"><a href="#布局视图" class="headerlink" title="布局视图"></a>布局视图</h2><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- layouts/main.blade.php --&gt;</span><br><span class="line"><span class="meta">@yield(<span class="string">&#x27;title&#x27;</span>)</span></span><br><span class="line"><span class="meta">@yield(<span class="string">&#x27;header&#x27;</span>)</span></span><br><span class="line"><span class="meta">@yield(<span class="string">&#x27;content&#x27;</span>)</span></span><br><span class="line"><span class="meta">@yield(<span class="string">&#x27;footer&#x27;</span>)</span></span><br></pre></td></tr></table></figure>

<h2 id="普通视图"><a href="#普通视图" class="headerlink" title="普通视图"></a>普通视图</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- index.blade.php --&gt;</span><br><span class="line">@<span class="keyword">extends</span>(<span class="string">&#x27;layouts.main&#x27;</span>)</span><br><span class="line">@<span class="title function_ invoke__">section</span>(<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;PAGE NAME&#x27;</span>)</span><br><span class="line">@<span class="title function_ invoke__">section</span>(<span class="string">&#x27;header&#x27;</span>)</span><br><span class="line">  &lt;!-- header detail --&gt;</span><br><span class="line">  &#123;&#123; <span class="variable">$variable</span>-&gt;attr &#125;&#125;</span><br><span class="line">&lt;!-- Include sub view --&gt;</span><br><span class="line">@<span class="keyword">include</span>(<span class="string">&#x27;shared.navbar&#x27;</span>)</span><br><span class="line">@<span class="title function_ invoke__">section</span>(<span class="string">&#x27;content&#x27;</span>)</span><br><span class="line">  &lt;!-- content detail --&gt;</span><br><span class="line">	@<span class="keyword">if</span> (...)</span><br><span class="line">	    &#123;&#123; <span class="title function_ invoke__">time</span>() &#125;&#125;</span><br><span class="line">	@<span class="keyword">elseif</span> (...)</span><br><span class="line">	    &#123;&#123; some php code here &#125;&#125;</span><br><span class="line">	@<span class="keyword">else</span></span><br><span class="line">	    &#123;&#123; php &#125;&#125; <span class="keyword">or</span> html all ok</span><br><span class="line">  	@<span class="keyword">endif</span></span><br><span class="line">      </span><br><span class="line">@<span class="title function_ invoke__">section</span>(<span class="string">&#x27;footer&#x27;</span>)</span><br><span class="line">  &lt;!-- footer detail --&gt;</span><br><span class="line">@stop</span><br><span class="line">&lt;!-- <span class="keyword">or</span> @endsection --&gt;</span><br></pre></td></tr></table></figure>

<p>更多例子参照(<a target="_blank" rel="noopener" href="https://cs.laravel-china.org/#blade">这里</a>, <a target="_blank" rel="noopener" href="https://d.laravel-china.org/docs/5.1/blade">这里</a>)</p>
<h1 id="Data"><a href="#Data" class="headerlink" title="Data"></a>Data</h1><h2 id="将数据传递到视图"><a href="#将数据传递到视图" class="headerlink" title="将数据传递到视图"></a>将数据传递到视图</h2><ul>
<li>数组格式</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;/&#x27;</span>, function () &#123;</span><br><span class="line">    <span class="variable">$data</span> = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] ;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">view</span>(<span class="string">&#x27;welcome&#x27;</span>, [<span class="string">&#x27;data&#x27;</span> =&gt; <span class="variable">$data</span>]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><code>compact()</code></li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;/&#x27;</span>, function () &#123;</span><br><span class="line">    <span class="variable">$data</span> = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] ;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">view</span>(<span class="string">&#x27;welcome&#x27;</span>, <span class="title function_ invoke__">compact</span>(<span class="string">&#x27;data&#x27;</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><code>with()</code></li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;/&#x27;</span>, function () &#123;</span><br><span class="line">    <span class="variable">$data</span> = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] ;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">view</span>(<span class="string">&#x27;welcome&#x27;</span>)-&gt;<span class="title function_ invoke__">with</span>(<span class="string">&#x27;data&#x27;</span> =&gt; <span class="variable">$data</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>动态方法</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;/&#x27;</span>, function () &#123;</span><br><span class="line">    <span class="variable">$data</span> = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] ;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">view</span>(<span class="string">&#x27;welcome&#x27;</span>)-&gt;<span class="title function_ invoke__">withData</span>(<span class="variable">$data</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="数据库驱动"><a href="#数据库驱动" class="headerlink" title="数据库驱动"></a>数据库驱动</h2><ul>
<li><code>config/database.php</code></li>
</ul>
<p>找到 <code>&#39;default&#39; =&gt; env(&#39;DB_CONNECTION&#39;, &#39;mysql&#39;)</code> ,修改成需要的驱动就可以了.</p>
<blockquote>
<p>If use sqlite(file based database for small project), please comment the DB_* fields in <code>.env</code> file.</p>
</blockquote>
<h2 id="Migration"><a href="#Migration" class="headerlink" title="Migration"></a><code>Migration</code></h2><blockquote>
<p><strong>Migration: The Version Controll of Database</strong></p>
</blockquote>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">1.</span> define the <span class="keyword">table</span> we want <span class="keyword">to</span> <span class="keyword">create</span></span><br><span class="line">php artisan make:migration create_users_table <span class="comment">--create=user</span></span><br><span class="line"></span><br><span class="line"># <span class="number">2.</span> custom the <span class="keyword">table</span> structure <span class="keyword">in</span> /<span class="keyword">database</span>/migrations/DATATIME_create_user_table.php@up() <span class="keyword">function</span></span><br><span class="line"></span><br><span class="line"># <span class="number">3.</span> actual <span class="keyword">create</span> the <span class="keyword">table</span> we defined <span class="keyword">before</span> <span class="keyword">into</span> our configured <span class="keyword">database</span></span><br><span class="line">php artisan migrate</span><br><span class="line"></span><br><span class="line"># <span class="number">4.</span> <span class="keyword">delete</span> <span class="keyword">tables</span> <span class="keyword">if</span> we want modify it, migrate it <span class="keyword">to</span> others env, etc.</span><br><span class="line">php artisan migrate:<span class="keyword">rollback</span></span><br></pre></td></tr></table></figure>

<h2 id="Tinker"><a href="#Tinker" class="headerlink" title="Tinker"></a><code>Tinker</code></h2><blockquote>
<p>你的项目的所有PHP laravel方法能够被执行在Tinker</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">php artisan tinker</span><br><span class="line"></span><br><span class="line">DB::<span class="built_in">table</span>(<span class="string">&#x27;users&#x27;</span>)-&gt;<span class="built_in">get</span>();</span><br></pre></td></tr></table></figure>

<p>命名空间等于文件夹结构。</p>
<h2 id="命名空间的回顾"><a href="#命名空间的回顾" class="headerlink" title="命名空间的回顾"></a><code>命名空间</code>的回顾</h2><p>在像PHP这样的编程语言中 命名空间用于放置类，避免类名相同时的歧义。</p>
<p>在laravel，定位的两种方法的类：</p>
<ul>
<li>use <code>use \Path\To\Class</code>; before the class defination.</li>
<li>use <code>\Classname</code> in the function block.</li>
</ul>
<p><strong>注意</strong>，当您不使用任何命名空间时，PHP将在当前命名空间中搜索您需要的类。</p>
<h2 id="查询生成器"><a href="#查询生成器" class="headerlink" title="查询生成器"></a>查询生成器</h2><p>这是<code>Laravel</code>一个传统与数据层交互方式。</p>
<p>按照这里的演示：<a target="_blank" rel="noopener" href="https://cs.laravel-china.org/#db">这里</a> AND <a target="_blank" rel="noopener" href="http://d.laravel-china.org/docs/5.1/queries">这里</a></p>
<h2 id="Eloquent-ORM-of-Laravel"><a href="#Eloquent-ORM-of-Laravel" class="headerlink" title="Eloquent: ORM of Laravel"></a><code>Eloquent</code>: ORM of Laravel</h2><p>简单地说，它只是<code>MVC</code>设计模式中的<code>M</code>层。</p>
<p>不同的是，它是在PHP的活动记录实现与数据库表进行交互，而不是使用传统的查询生成器。</p>
<p>其结果是，每个表有一个模型，模型代表表和表的增删改查选项更方便和愉快的模型。</p>
<p>在<code>Laravel</code>中的使用步骤:</p>
<ul>
<li>1.<strong>Create table via <code>make:migration</code></strong></li>
<li>2.<strong>Insert data into the table</strong></li>
<li>3.<strong>Make a Model reference to the table</strong></li>
</ul>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php artisan make:model Models/<span class="keyword">User</span> <span class="title">-m</span> <span class="comment"># --migration</span></span><br></pre></td></tr></table></figure>

<p><code>- m</code> 选项仅用于我们没有创建此模型响应的表时。</p>
<p><strong>注意</strong>这里有一条规则：</p>
<blockquote>
<p><strong>Model name must be singular, but table name must be plurals.</strong></p>
</blockquote>
<p><strong>模型名称必须是单数，但表名必须是复数。</strong></p>
<p>For example, model name of table <code>histories</code> should be <code>history</code>.</p>
<ul>
<li>4.<strong>Using Model in controller</strong></li>
</ul>
<p>For example, we have created a table <code>users</code>, and a model <code>User</code> in namespace <code>App\Models\User</code>, contents of <code>App\Http\routes.php</code> like these:</p>
<p>在路由中使用:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Route::<span class="keyword">get</span>(<span class="string">&#x27;users&#x27;</span>, <span class="string">&#x27;Users@index&#x27;</span>);</span><br><span class="line"></span><br><span class="line"># below two routes <span class="keyword">are</span> same intend, just <span class="keyword">for</span> explain here</span><br><span class="line"># use <span class="keyword">only</span> <span class="keyword">one</span> way if you <span class="keyword">like</span></span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> Will <span class="keyword">show</span> <span class="keyword">specific</span> <span class="keyword">user</span> <span class="keyword">by</span> id</span><br><span class="line">Route::<span class="keyword">get</span>(<span class="string">&#x27;users/&#123;id&#125;&#x27;</span>, <span class="string">&#x27;Users@show&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> Will <span class="keyword">show</span> <span class="keyword">specific</span> <span class="keyword">user</span> <span class="keyword">by</span> instance</span><br><span class="line">Route::<span class="keyword">get</span>(<span class="string">&#x27;users/&#123;user&#125;&#x27;</span>, <span class="string">&#x27;Users@show&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>在控制器中使用:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Http</span>\<span class="title class_">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Models</span>\<span class="title">User</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Users</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * get all users</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">User</span>::<span class="title function_ invoke__">all</span>() ;   <span class="comment">// Automatically JSON Response</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 1. show specific user by id</span></span><br><span class="line"><span class="comment">     * !!! param name `$id` don&#x27;t have to response to the `&#123;id&#125;` in routes defination</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params"><span class="variable">$id</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$user</span> = <span class="title class_">User</span>::<span class="title function_ invoke__">find</span>(<span class="variable">$id</span>) ;    <span class="comment">// Also JSON if has the result</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$user</span> ? <span class="variable">$user</span> : <span class="string">&#x27;user not found&#x27;</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 2. show specific user by instance</span></span><br><span class="line"><span class="comment">     * !!! param name `$user` must response to the `&#123;user&#125;` in routes defination</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params">User <span class="variable">$user</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$user</span> ;    <span class="comment">// JSON</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>5.<strong>Pass the result data to blade views when necessary</strong></li>
</ul>
<p>只需要注意: <code>.</code>是连接&#x2F;目录的意思, 比如 <code>view(users.show)</code> 意思是 <code>resources/views/users/show.blade.php</code></p>
<h1 id="Eloquent"><a href="#Eloquent" class="headerlink" title="Eloquent"></a><code>Eloquent</code></h1><p>举个简单的例子 我们创建表: <code>users</code>, <code>cards</code>, <code>notes</code></p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">php artisan make:<span class="keyword">model</span> <span class="keyword">Models</span>\User -m</span><br><span class="line">php artisan make:<span class="keyword">model</span> <span class="keyword">Models</span>\<span class="keyword">Card</span> -m</span><br><span class="line">php artisan make:<span class="keyword">model</span> <span class="keyword">Models</span>\Note -m</span><br></pre></td></tr></table></figure>

<p>我们所定义的每个<code>up()</code>方法：</p>
<blockquote>
<p>在 <code>database/migrations/</code></p>
</blockquote>
<ul>
<li><code>CreateUsersTable:</code></li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Schema</span>::<span class="title function_ invoke__">create</span>(<span class="string">&#x27;users&#x27;</span>, function (Blueprint <span class="variable">$table</span>) &#123;</span><br><span class="line">    <span class="variable">$table</span>-&gt;<span class="title function_ invoke__">increments</span>(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">    <span class="variable">$table</span>-&gt;<span class="keyword">string</span>(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line">    <span class="variable">$table</span>-&gt;<span class="title function_ invoke__">timestamps</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><code>CreateCardsTable:</code></li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Schema</span>::<span class="title function_ invoke__">create</span>(<span class="string">&#x27;cards&#x27;</span>, function (Blueprint <span class="variable">$table</span>) &#123;</span><br><span class="line">    <span class="variable">$table</span>-&gt;<span class="title function_ invoke__">increments</span>(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">    <span class="variable">$table</span>-&gt;<span class="keyword">integer</span>(<span class="string">&#x27;user_id&#x27;</span>)-&gt;<span class="title function_ invoke__">unsigned</span>()-&gt;<span class="title function_ invoke__">index</span>();</span><br><span class="line">    <span class="variable">$table</span>-&gt;<span class="keyword">string</span>(<span class="string">&#x27;title&#x27;</span>);</span><br><span class="line">    <span class="variable">$table</span>-&gt;<span class="title function_ invoke__">timestamps</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><code>CreateNotesTable:</code></li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Schema</span>::<span class="title function_ invoke__">create</span>(<span class="string">&#x27;notes&#x27;</span>, function (Blueprint <span class="variable">$table</span>) &#123;</span><br><span class="line">    <span class="variable">$table</span>-&gt;<span class="title function_ invoke__">increments</span>(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">    <span class="variable">$table</span>-&gt;<span class="keyword">integer</span>(<span class="string">&#x27;card_id&#x27;</span>)-&gt;<span class="title function_ invoke__">unsigned</span>()-&gt;<span class="title function_ invoke__">index</span>();</span><br><span class="line">    <span class="variable">$table</span>-&gt;<span class="title function_ invoke__">text</span>(<span class="string">&#x27;content&#x27;</span>);</span><br><span class="line">    <span class="variable">$table</span>-&gt;<span class="title function_ invoke__">timestamps</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>显然, 他们之间的关系: <code>user has cards</code>, <code>cards has notes</code>. 测试前, 运行迁移:</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">php artisan migrate</span></span><br></pre></td></tr></table></figure>

<p>Ok then. How to define the relationship with Eloquent are basically the same, so we take the cards has notes relationship to explain how it works.</p>
<p>好吧, 怎么使用<code>Eloquent</code>关联模型基本一致, 所以我们就使用 <code>cards</code> has <code>notes</code> 的关系来解释.</p>
<h2 id="Get-x2F-Query"><a href="#Get-x2F-Query" class="headerlink" title="Get&#x2F;Query"></a><code>Get</code>&#x2F;<code>Query</code></h2><ul>
<li><strong><code>No Eloquent</code></strong></li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">php artisan tinker</span><br><span class="line"><span class="comment"># 1. Prepare one card whose id = 1</span></span><br><span class="line"><span class="variable">$card</span> = <span class="keyword">new</span> <span class="title class_">App\Models\Card</span>;</span><br><span class="line"><span class="variable">$card</span>-&gt;user_id = <span class="number">1</span>;    <span class="comment">// assume it&#x27;s 1 here</span></span><br><span class="line"><span class="variable">$card</span>-&gt;title   = <span class="string">&#x27;1st card&#x27;</span>;</span><br><span class="line"><span class="variable">$card</span>-&gt;<span class="title function_ invoke__">save</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. Create a note with it&#x27;s card_id = 1</span></span><br><span class="line"><span class="variable">$note</span> = <span class="keyword">new</span> <span class="title class_">App\Models\Note</span>;</span><br><span class="line"><span class="variable">$note</span>-&gt;card_id = <span class="number">1</span>;</span><br><span class="line"><span class="variable">$note</span>-&gt;content = <span class="string">&#x27;1st note&#x27;</span>;</span><br><span class="line"><span class="variable">$note</span>-&gt;<span class="title function_ invoke__">save</span>();</span><br></pre></td></tr></table></figure>

<p>Yes, it just manually relate their relationship. It’s a little bit inelegant.</p>
<ul>
<li><p><strong><code>With Eloquent</code></strong></p>
<ul>
<li>define the <code>notes()</code> method in Card Model</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">notes</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">hasMany</span>(<span class="title class_">Note</span>::<span class="variable language_">class</span>);    <span class="comment">// either `Note::class` or `\App\Models\Note`</span></span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">path</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&#x27;/cards/&#x27;</span> . <span class="variable language_">$this</span>-&gt;id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当我们使用 <code>\App\Models\Notes</code> 将转化成对象, 使用 <code>Notes::class</code>将转化成<strong>类的字符串表示形式</strong>。</p>
<ul>
<li>call the <code>notes()</code> method in Card Model instance</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">php artisan tinker</span><br><span class="line"></span><br><span class="line"><span class="variable">$card</span> = <span class="title class_">App\Models\Card</span>::<span class="title function_ invoke__">first</span>()</span><br><span class="line"></span><br><span class="line"><span class="variable">$card</span>-&gt;notes-&gt;<span class="title function_ invoke__">first</span>()        <span class="comment"># as collection</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Or</span></span><br><span class="line"><span class="comment"># $card-&gt;notes[0]        # as array</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Or</span></span><br><span class="line"><span class="comment"># $card-&gt;notes()-&gt;first()    # as object</span></span><br></pre></td></tr></table></figure>

<p>集合和对象的不同在于最后的查询<code>sql</code></p>
<p>通过一个测试证明下:</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">php artisan tinker   <span class="comment"># refresh the modifications in project</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Setup a listener when query event occurs</span></span><br><span class="line">&gt;&gt;&gt; DB::listen(<span class="keyword">function</span> ($query)&#123; echo $query-&gt;sql; &#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; $card = <span class="keyword">new</span> App<span class="string">\Models\Card::first()</span></span><br><span class="line">select * <span class="keyword">from</span> <span class="string">&quot;cards&quot;</span> limit <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># First execute the get-card-notes query</span></span><br><span class="line">&gt;&gt;&gt; $card-&gt;notes</span><br><span class="line">select * <span class="keyword">from</span> <span class="string">&quot;notes&quot;</span> where <span class="string">&quot;notes&quot;</span>.<span class="string">&quot;card_id&quot;</span> = ? <span class="keyword">and</span> <span class="string">&quot;note&quot;</span>.<span class="string">&quot;card_id&quot;</span> <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Re-execute the same query</span></span><br><span class="line">&gt;&gt;&gt; $card-&gt;notes</span><br><span class="line"><span class="comment"># You will see nothing here because the last query result is stored in the $card object and fetch them directly from object rather than the database</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Check if the $card object has the notes relationships here</span></span><br><span class="line">&gt;&gt;&gt; $card</span><br><span class="line"><span class="comment"># You will see the notes of this card here</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Check if notes relationship still exists after we refresh the object</span></span><br><span class="line">&gt;&gt;&gt; $card-&gt;fresh()</span><br><span class="line">select * <span class="keyword">from</span> <span class="string">&quot;cards&quot;</span> where <span class="string">&quot;id&quot;</span> = ? limit <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt; $card</span><br><span class="line"><span class="comment"># You wil note see the notes of this card here any more because the resuls cache are erased after `fresh()`</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># If we use as collection, the sql of get first note record might be like this:</span></span><br><span class="line">&gt;&gt;&gt; $card-&gt;fresh<span class="function"><span class="params">()</span>-&gt;</span>notes-&gt;first()</span><br><span class="line">select * <span class="keyword">from</span> <span class="string">&quot;cards&quot;</span> where <span class="string">&quot;id&quot;</span> = ? limit <span class="number">1</span></span><br><span class="line">select * <span class="keyword">from</span> <span class="string">&quot;notes&quot;</span> where <span class="string">&quot;notes&quot;</span>.<span class="string">&quot;card_id&quot;</span> = ? <span class="keyword">and</span> <span class="string">&quot;notes&quot;</span>.<span class="string">&quot;card_id&quot;</span> <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># If we use as object method, the sql of get first note record might be like this:</span></span><br><span class="line">&gt;&gt;&gt; $card-&gt;fresh<span class="function"><span class="params">()</span>-&gt;</span>notes<span class="function"><span class="params">()</span>-&gt;</span>first()</span><br><span class="line">select * <span class="keyword">from</span> <span class="string">&quot;cards&quot;</span> where <span class="string">&quot;id&quot;</span> = ? limit <span class="number">1</span></span><br><span class="line">select * <span class="keyword">from</span> <span class="string">&quot;notes&quot;</span> where <span class="string">&quot;notes&quot;</span>.<span class="string">&quot;card_id&quot;</span> = ? <span class="keyword">and</span> <span class="string">&quot;notes&quot;</span>.<span class="string">&quot;card_id&quot;</span> <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span> limit <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>测试结果和上面的结论一致.</p>
</li>
</ul>
<h2 id="hasMany-and-belongsTo"><a href="#hasMany-and-belongsTo" class="headerlink" title="hasMany and belongsTo"></a><code>hasMany</code> and <code>belongsTo</code></h2><blockquote>
<p>Moreover, we can say that note also belongs to card. So here is how eloquent deal with this <code>belongs-to</code> relationship here.</p>
</blockquote>
<p><strong>简单来说:就是 谁拥有谁&#x3D;&#x3D;谁属于谁</strong></p>
<ul>
<li><ul>
<li>define the <code>card()</code> method in Note Model:</li>
</ul>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">function</span> <span class="title function_">card</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> $<span class="keyword">this</span>-&gt;belongsTo(Card::<span class="keyword">class</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><ul>
<li>call the <code>card</code> method in Note Model instance</li>
</ul>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">php artisan tinker</span><br><span class="line"></span><br><span class="line"><span class="meta"><span class="keyword">$note</span> = App\Models\Note::first()</span></span><br><span class="line"></span><br><span class="line"><span class="meta"><span class="keyword">$note</span>-&gt;card</span></span><br></pre></td></tr></table></figure></li>
</ul>
<blockquote>
<p><strong>Be aware that</strong>: <code>hasMany()</code> related method is <code>notes()</code>, which is resonable because one card can has many notes, and <code>belongsTo()</code> related method is <code>card()</code>, which is resonable because one note only belongs to one card.</p>
</blockquote>
<p>注意到: <code>hasMany()</code> 对应的方法是 <code>notes</code> (复数),是因为 <strong>一张卡可以有很多笔记</strong>, <code>belongTo</code> 对应的方法是 <code>card()</code> (单数),是因为 <strong>一个笔记只属于一张卡</strong></p>
<p>你不应该创建方法名为 <code>note()</code> 或 <code>cards()</code>，因为它没有任何意义，必须回应你叫它什么方法。</p>
<p><strong>记住</strong>，<code>hasmany()</code> 和复数的方法有关，<code>belongsto()</code>和单数的方法相关。</p>
<h2 id="Create-x2F-save"><a href="#Create-x2F-save" class="headerlink" title="Create&#x2F;save"></a><code>Create</code>&#x2F;<code>save</code></h2><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">php artisan tinker</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a new Note</span></span><br><span class="line">$note = <span class="keyword">new</span> App<span class="string">\Models\Note</span></span><br><span class="line">$nots-&gt;content = <span class="string">&#x27;second note&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Decide which card to associate with</span></span><br><span class="line">$card = App<span class="string">\Models\Card::first()</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Save a exists note by `save()`</span></span><br><span class="line">$card-&gt;notes<span class="function"><span class="params">()</span>-&gt;</span>save($note)    <span class="comment"># we cann&#x27;t use $card-&gt;notes-&gt;save() here</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Or create a new note by `create()`</span></span><br><span class="line">$card-&gt;notes<span class="function"><span class="params">()</span>-&gt;</span>create([<span class="string">&#x27;content&#x27;</span>=&gt;<span class="string">&#x27;third note&#x27;</span>])    <span class="comment"># make sure that `content` is fillable in Note Model</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># See the new note associated with first card</span></span><br><span class="line">$card-&gt;notes</span><br><span class="line"><span class="comment"># Yout will see new note was already in $card object</span></span><br></pre></td></tr></table></figure>

<p><strong>Notice</strong> that here we didn’t set the <code>card_id</code> for <code>$note</code>, because eloquent automatically did this for us.</p>
<p><strong>When we creating new record, we cann’t use collections any more, because it is only used for query-like operations.</strong></p>
<p>此外，当我们通过 <code>create()</code>直接创建一个新的记录, 需要某个字段批量赋值如:<code>content</code>, 需要在<code>$fillable</code>定义.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Note</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$fillable</span> = [<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">card</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    	<span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">belongsTo</span>(<span class="title class_">Card</span>::<span class="variable language_">class</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>$fillable</code> 可以作为设置被批量赋值的属性的「白名单」,  这也是<code>Laravel</code>中避免攻击的方法之一.</p>
<h1 id="Form"><a href="#Form" class="headerlink" title="Form"></a><code>Form</code></h1><p>基于之前的例子:我们有 <code>resources/views/cards/show.blade.php </code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">extends</span>(<span class="string">&#x27;layouts.main&#x27;</span>)</span><br><span class="line">@<span class="title function_ invoke__">section</span>(<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;show card&#x27;</span>)</span><br><span class="line">@<span class="title function_ invoke__">section</span>(<span class="string">&#x27;content&#x27;</span>)</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">row</span>&quot;&gt;</span></span><br><span class="line"><span class="class">	&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">col</span>-<span class="title">md</span>-6&quot;&gt;</span></span><br><span class="line"><span class="class">		&lt;<span class="title">h1</span>&gt;</span></span><br><span class="line"><span class="class">			</span>&#123;&#123; <span class="variable">$card</span>-&gt;title &#125;&#125;</span><br><span class="line">		&lt;/h1&gt;</span><br><span class="line">		&lt;ul <span class="class"><span class="keyword">class</span>=&quot;<span class="title">list</span>-<span class="title">group</span>&quot;&gt;</span></span><br><span class="line"><span class="class">			@<span class="title">foreach</span> ($<span class="title">card</span>-&gt;<span class="title">notes</span> <span class="title">as</span> $<span class="title">note</span>)</span></span><br><span class="line"><span class="class">				&lt;<span class="title">li</span> <span class="title">class</span>=&quot;<span class="title">list</span>-<span class="title">group</span>-<span class="title">item</span>&quot;&gt;</span></span><br><span class="line"><span class="class">					</span>&#123;&#123; <span class="variable">$note</span>-&gt;content &#125;&#125;</span><br><span class="line">				&lt;/li&gt;</span><br><span class="line">			@<span class="keyword">endforeach</span></span><br><span class="line">		&lt;/ul&gt;</span><br><span class="line">		&lt;hr&gt;</span><br><span class="line">		&lt;h2&gt;</span><br><span class="line">			Add More Notes Here</span><br><span class="line">		&lt;/h2&gt;</span><br><span class="line">		&lt;form method=<span class="string">&quot;POST&quot;</span> action=<span class="string">&quot;/cards/&#123;&#123; <span class="subst">$card</span>-&gt;id &#125;&#125;/notes&quot;</span>&gt;</span><br><span class="line">		&lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;_token&quot;</span> value=<span class="string">&quot;&#123;&#123; csrf_token() &#125;&#125;&quot;</span>&gt;</span><br><span class="line">			&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">form</span>-<span class="title">group</span>&quot;&gt;</span></span><br><span class="line"><span class="class">				&lt;<span class="title">textarea</span> <span class="title">name</span>=&quot;<span class="title">content</span>&quot; <span class="title">class</span>=&quot;<span class="title">form</span>-<span class="title">control</span>&quot;&gt;&lt;/<span class="title">textarea</span>&gt;</span></span><br><span class="line"><span class="class">			&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">form</span>-<span class="title">group</span>&quot;&gt;</span></span><br><span class="line"><span class="class">				&lt;<span class="title">button</span> <span class="title">type</span>=&quot;<span class="title">submit</span>&quot; <span class="title">class</span>=&quot;<span class="title">btn</span> <span class="title">btn</span>-<span class="title">primary</span>&quot;&gt;</span></span><br><span class="line"><span class="class">					<span class="title">Add</span> <span class="title">Note</span></span></span><br><span class="line"><span class="class">				&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="class">			&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">		&lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">	&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">@<span class="title">stop</span></span></span><br></pre></td></tr></table></figure>

<p>创建 <code>routes.php</code>:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Route::<span class="built_in">post</span>(<span class="string">&#x27;cards/&#123;card&#125;/notes&#x27;</span>, <span class="string">&#x27;Notes@store&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>创建控制器 <code>Notes@store</code>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">store</span>(<span class="params">Request <span class="variable">$request</span>, Card <span class="variable">$card</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// return $request-&gt;all();</span></span><br><span class="line">    <span class="comment">// return \Request::all();</span></span><br><span class="line">    <span class="comment">// return request()-&gt;all();</span></span><br><span class="line">    <span class="comment">// return $card;</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 1</span></span><br><span class="line">    <span class="comment">// $note = new Note;</span></span><br><span class="line">    <span class="comment">// $note-&gt;content = $request-&gt;content;</span></span><br><span class="line">    <span class="comment">// $card-&gt;notes()-&gt;save($note);</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2</span></span><br><span class="line">    <span class="comment">// $card-&gt;notes()-&gt;save([</span></span><br><span class="line">    <span class="comment">//     new Note([</span></span><br><span class="line">    <span class="comment">//         &#x27;content&#x27; =&gt; $request-&gt;content</span></span><br><span class="line">    <span class="comment">//         ])</span></span><br><span class="line">    <span class="comment">//     ]);</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 3</span></span><br><span class="line">    <span class="comment">// $card-&gt;notes-&gt;create([</span></span><br><span class="line">    <span class="comment">//         &#x27;content&#x27; =&gt; $request-&gt;content</span></span><br><span class="line">    <span class="comment">//     ]);</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 4</span></span><br><span class="line">    <span class="variable">$card</span>-&gt;<span class="title function_ invoke__">notes</span>()-&gt;<span class="title function_ invoke__">create</span>(<span class="title function_ invoke__">request</span>()-&gt;<span class="title function_ invoke__">all</span>());      </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// return \Request::to(&#x27;path/to/new/uri&#x27;);</span></span><br><span class="line">    <span class="comment">// return redirect()-&gt;to(&#x27;path/to/new/uri&#x27;);</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">back</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意:</strong></p>
<ul>
<li><ul>
<li>If you want use eloquent as an instance, the param name <code>$card</code> must <strong>equals to</strong> the route catch name <code>&#123;card&#125;</code>, here <code>card</code> equals <code>card</code>. Or <code>$card</code> in method will be nothing, which is unexpected.</li>
</ul>
</li>
<li><ul>
<li>When we use <code>create()</code> to insert an relationship, we must make sure that we had stipulated the <code>$fillable</code> in related model, as we talked before.</li>
</ul>
</li>
</ul>
<p>Since card and note has relationship here, so we can add a method to describle more clearer what we want to do, we can add a method <code>addNote()</code> in model Card, like this:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">addNote</span>(<span class="params">Note <span class="variable">$note</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">notes</span>()-&gt;<span class="title function_ invoke__">save</span>(<span class="variable">$note</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后, 控制器中 <code>Notes@store()</code>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">store</span>(<span class="params">Request <span class="variable">$request</span>, Card <span class="variable">$card</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$card</span>-&gt;<span class="title function_ invoke__">addNote</span>(</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Note</span>(<span class="variable">$request</span>-&gt;<span class="title function_ invoke__">all</span>())</span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">back</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="RESTful-Principles-Review"><a href="#RESTful-Principles-Review" class="headerlink" title="RESTful Principles Review"></a><code>RESTful Principles Review</code></h2><p><code>RESTful</code>接口整个说明本表：</p>
<p><u><a target="_blank" rel="noopener" href="https://d.laravel-china.org/docs/5.5/controllers#resource-controllers">资源控制器</a></u></p>
<p>此外，由于浏览器只直接理解<code>GET</code>和<code>POST</code>方法，所以遵循<code>REST</code>约定可以像这样做:</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  </span><span class="template-variable">&#123;&#123; <span class="name">method_field</span>(<span class="name">&#x27;PATCH | DELETE | PUT&#x27;</span>) &#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">  <span class="comment">&lt;!-- which equals to: --&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="comment">&lt;!-- &lt;input type=&quot;hidden&quot; name=&quot;method&quot; value=&quot;PATCH&quot;&gt; --&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="comment">&lt;!-- more form elements --&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h2 id="Update-And-Eager-Loading"><a href="#Update-And-Eager-Loading" class="headerlink" title="Update And Eager Loading"></a><code>Update</code> And <code>Eager Loading</code></h2><p><strong>预先加载</strong>是避免大量的数据库查询该对象的数据可以得到一个查询通过建立<code>laravel</code>模型关系的有效途径。</p>
<blockquote>
<p>Before we using eager loading, if we want to get both the notes of one card, and the user this card belongs to, we may query <em>N+1</em> times like this (<code>notes</code> <strong>table must has fileds named with <code>user_id</code> and <code>card_id</code></strong>):</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">showByInstance</span>(<span class="params">Card <span class="variable">$card</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$card</span>-&gt;notes[<span class="number">0</span>]-&gt;user;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>这里需要查询两次, 这是低效的</strong></p>
<p>使用预加载,我们可以将两次查询合并成一次,就像:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">showByInstance</span>(<span class="params">Card <span class="variable">$card</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$card</span>-&gt;<span class="title function_ invoke__">load</span>(<span class="string">&#x27;notes.user&#x27;</span>);    <span class="comment">// notes means Card@notes() user means Note@user()</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Or</span></span><br><span class="line">    <span class="comment">// return $card-&gt;with(&#x27;notes.user&#x27;);</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Or only load notes of this card</span></span><br><span class="line">    <span class="comment">// return $card-&gt;load(&#x27;notes&#x27;);</span></span><br><span class="line">    <span class="comment">// return $card-&gt;with(&#x27;note&#x27;)-&gt;find(1);    // 1 means this id of the card we want to find</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Validation"><a href="#Validation" class="headerlink" title="Validation"></a><code>Validation</code></h2><ul>
<li><ul>
<li><code>Form input</code></li>
</ul>
</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">addNote</span>(<span class="params">Request <span class="variable">$request</span>, Card <span class="variable">$card</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">validate</span>(<span class="variable">$request</span>,[</span><br><span class="line">        <span class="string">&#x27;content&#x27;</span> =&gt; <span class="string">&#x27;required|min:10&#x27;</span></span><br><span class="line">    ]);     <span class="comment">// Controller =&gt; ValidatesRequests@validate</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><ul>
<li><code>CSRF</code>: See detail in FAQ.</li>
</ul>
</li>
<li><ul>
<li><code>Middleware</code></li>
</ul>
</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">group</span>([</span><br><span class="line">    <span class="string">&#x27;middleware&#x27;</span> =&gt; [<span class="string">&#x27;web&#x27;</span>],</span><br><span class="line">], function () &#123;</span><br><span class="line">    <span class="title class_">Route</span>::<span class="title function_ invoke__">post</span>(<span class="string">&#x27;cards/&#123;card&#125;/notes&#x27;</span>, <span class="string">&#x27;Cards@addNote&#x27;</span>);</span><br><span class="line">    <span class="comment">// Route::post(&#x27;cards/&#123;card&#125;/notes&#x27;, &#x27;Notes@store&#x27;);</span></span><br><span class="line">    <span class="comment">// More routes</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><ul>
<li><code>Errors</code></li>
</ul>
</li>
</ul>
<p>每个视图都可以共享($errors)错误变量。</p>
<ul>
<li><ul>
<li><code>old(&#39;field_name&#39;)</code></li>
</ul>
</li>
</ul>
<blockquote>
<p>When form check fails, the preview wrong data are <code>withInput()</code> in the redirect, and we can put it into the right elements.</p>
</blockquote>
<p>通过 <code>old()</code>,获取上一次输入的内容.</p>
<h2 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h2><ul>
<li><u><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/25237415/php-artisan-migratereset-failed-to-open-stream-no-such-file-or-directory">php artisan migrate:reset failed to open stream: No such file or directory?</a></u></li>
</ul>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer dump-<span class="built_in">auto</span>load</span><br></pre></td></tr></table></figure>

<ul>
<li><u><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/34866404/tokenmismatchexception-in-verifycsrftoken-php-line-67">TokenMismatchException in VerifyCsrfToken.php Line 67?</a></u></li>
</ul>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;_token&quot;</span> <span class="attr">value</span>=<span class="string">&quot;</span></span></span><span class="template-variable">&#123;&#123; <span class="name">csrf_token</span>() &#125;&#125;</span><span class="language-xml"><span class="tag"><span class="string">&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="comment">&lt;!-- Or --&gt;</span></span></span><br><span class="line"><span class="language-xml"></span><span class="template-variable">&#123;&#123; <span class="name">csrf_field</span>() &#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="comment">&lt;!-- Or set into meta tag --&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;csrf-token&quot;</span> <span class="attr">content</span>=<span class="string">&quot;</span></span></span><span class="template-variable">&#123;&#123; <span class="name">csrf_token</span>() &#125;&#125;</span><span class="language-xml"><span class="tag"><span class="string">&quot;</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<ul>
<li><u><a target="_blank" rel="noopener" href="https://laracasts.com/discuss/channels/general-discussion/whats-the-differences-between-put-and-patch?page=1">What’s the differences between PUT and PATCH?</a></u></li>
</ul>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PUT = <span class="built_in">replace</span> <span class="keyword">the</span> ENTIRE RESOURCE <span class="keyword">with</span> <span class="keyword">the</span> <span class="built_in">new</span> representation provided (no mention <span class="keyword">of</span> related resources <span class="keyword">in</span> <span class="keyword">the</span> spec <span class="built_in">from</span> what i can see)<span class="comment"></span></span><br><span class="line"><span class="comment">// 用所提供的新表示替换整个资源（在我所看到的规范中没有提到相关资源）</span></span><br><span class="line"></span><br><span class="line">PATCH = <span class="built_in">replace</span> parts <span class="keyword">of</span> <span class="keyword">the</span> source resource <span class="keyword">with</span> <span class="keyword">the</span> values provided AND|OR other parts <span class="keyword">of</span> <span class="keyword">the</span> resource are updated that you havent provided (timestamps) AND|OR updating <span class="keyword">the</span> resource effects other resources (relationships)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="重置和刷新命令列表"><a href="#重置和刷新命令列表" class="headerlink" title="重置和刷新命令列表"></a>重置和刷新命令列表</h2><ul>
<li><p><code>php artisan clear-compiled</code>: 删除已编译的类文件</p>
</li>
<li><p><code>php artisan auth:clear-resets </code>: 刷新过期密码重置令牌</p>
</li>
<li><p><code>php artisan cache:clear</code>: 刷新应用程序缓存</p>
</li>
<li><p><code>php artisan config:clear</code>: 删除配置缓存文件</p>
</li>
<li><p><code>php artisan migrate:refresh</code>: 重置并重新运行所有迁移</p>
</li>
</ul>
<p><strong>Same with <code>migrate:rollback</code>, they will erase the data in database.</strong></p>
<ul>
<li><p><code>php artisan migrate:reset</code>: 回滚所有数据库迁移</p>
</li>
<li><p><code>php artisan queue:flush</code>: 刷新所有失败的队列作业</p>
</li>
<li><p><code>php artisan queue:forget</code>: 删除失败的队列作业</p>
</li>
<li><p><code>php artisan route:clear</code>: 删除路由缓存文件</p>
</li>
<li><p><code>php artisan view clear</code>: 清除所有的编译文件</p>
</li>
</ul>
<h1 id="参考-References"><a href="#参考-References" class="headerlink" title="参考(References)"></a>参考(References)</h1><ul>
<li><a target="_blank" rel="noopener" href="https://laracasts.com/series/laravel-5-from-scratch">Laracasts</a></li>
<li><a target="_blank" rel="noopener" href="https://laravel.com/docs/5.6">Laravel 5.6(英文)</a></li>
<li><a target="_blank" rel="noopener" href="https://d.laravel-china.org/docs/5.5">Laravel 5.5(中文)</a></li>
<li><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Laravel">Laravel 维基百科</a></li>
<li><a target="_blank" rel="noopener" href="https://lumen.laravel-china.org/docs/5.3/installation">Laravel&#x2F;Lumen</a></li>
<li><a target="_blank" rel="noopener" href="https://code.tutsplus.com/tutorials/your-one-stop-guide-to-laravel-commands--net-30349">Your One-Stop Guide to Laravel Commands</a></li>
</ul>

        
      
    </div>

    <footer class="article-footer">
      
      
      <div>
        <ul class="post-copyright">
          <li class="post-copyright-author">
          <strong>本文作者:  </strong>CAO XIAN LIANG</a>
          </li>
          <li class="post-copyright-link">
          <strong>本文链接:  </strong>
          <a href="/2018/01/16/Laravel-Basic-knowledge/" target="_blank" title="Laravel 基础知识">http://blog.caoxl.com/2018/01/16/Laravel-Basic-knowledge/</a>
          </li>
          <li class="post-copyright-license">
            <strong>版权声明:   </strong>
            本博客所有文章除特别声明外，均采用 <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">CC BY-NC-ND 4.0</a>
            许可协议。转载请注明出处
          </li>
         
        </ul>
<div>

      
      
      
      
        
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Framework/" rel="tag">Framework</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Laravel/" rel="tag">Laravel</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PHP/" rel="tag">PHP</a></li></ul>

      

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/01/16/Dig-Into-Laravel/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">上一篇</strong>
      <div class="article-nav-title">
        
          深入理解 Laravel
        
      </div>
    </a>
  
  
    <a href="/2018/01/16/Laravel-Dev-Notes/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <div class="article-nav-title">Laravel 使用笔记</div>
    </a>
  
</nav>

  
</article>

<!-- Table of Contents -->

  <aside id="toc-sidebar">
    <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%87%86%E5%A4%87"><span class="nav-number">1.</span> <span class="nav-text">准备</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%A8%E5%B1%80%E5%AE%89%E8%A3%85-Composer"><span class="nav-number">1.1.</span> <span class="nav-text">全局安装 Composer</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-Laravel-x2F-Lumen"><span class="nav-number">1.2.</span> <span class="nav-text">安装 Laravel&#x2F;Lumen</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%B8%A6%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BF%90%E8%A1%8C"><span class="nav-number">1.3.</span> <span class="nav-text">自带服务器运行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B3%A8%E6%84%8F"><span class="nav-number">1.4.</span> <span class="nav-text">注意</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Blade"><span class="nav-number">2.</span> <span class="nav-text">Blade</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%83%E5%B1%80%E8%A7%86%E5%9B%BE"><span class="nav-number">2.1.</span> <span class="nav-text">布局视图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%99%AE%E9%80%9A%E8%A7%86%E5%9B%BE"><span class="nav-number">2.2.</span> <span class="nav-text">普通视图</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Data"><span class="nav-number">3.</span> <span class="nav-text">Data</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%86%E6%95%B0%E6%8D%AE%E4%BC%A0%E9%80%92%E5%88%B0%E8%A7%86%E5%9B%BE"><span class="nav-number">3.1.</span> <span class="nav-text">将数据传递到视图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E9%A9%B1%E5%8A%A8"><span class="nav-number">3.2.</span> <span class="nav-text">数据库驱动</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Migration"><span class="nav-number">3.3.</span> <span class="nav-text">Migration</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Tinker"><span class="nav-number">3.4.</span> <span class="nav-text">Tinker</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E7%9A%84%E5%9B%9E%E9%A1%BE"><span class="nav-number">3.5.</span> <span class="nav-text">命名空间的回顾</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E7%94%9F%E6%88%90%E5%99%A8"><span class="nav-number">3.6.</span> <span class="nav-text">查询生成器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Eloquent-ORM-of-Laravel"><span class="nav-number">3.7.</span> <span class="nav-text">Eloquent: ORM of Laravel</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Eloquent"><span class="nav-number">4.</span> <span class="nav-text">Eloquent</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Get-x2F-Query"><span class="nav-number">4.1.</span> <span class="nav-text">Get&#x2F;Query</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#hasMany-and-belongsTo"><span class="nav-number">4.2.</span> <span class="nav-text">hasMany and belongsTo</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Create-x2F-save"><span class="nav-number">4.3.</span> <span class="nav-text">Create&#x2F;save</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Form"><span class="nav-number">5.</span> <span class="nav-text">Form</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#RESTful-Principles-Review"><span class="nav-number">5.1.</span> <span class="nav-text">RESTful Principles Review</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Update-And-Eager-Loading"><span class="nav-number">5.2.</span> <span class="nav-text">Update And Eager Loading</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Validation"><span class="nav-number">5.3.</span> <span class="nav-text">Validation</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#FAQ"><span class="nav-number">5.4.</span> <span class="nav-text">FAQ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%87%8D%E7%BD%AE%E5%92%8C%E5%88%B7%E6%96%B0%E5%91%BD%E4%BB%A4%E5%88%97%E8%A1%A8"><span class="nav-number">5.5.</span> <span class="nav-text">重置和刷新命令列表</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%82%E8%80%83-References"><span class="nav-number">6.</span> <span class="nav-text">参考(References)</span></a></li></ol>
    
    </div>
  </aside>

</section>
        
      </div>
      
      <footer id="footer">
  

  <div class="container">
      	<div class="row">
	      <p> Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/iTimeTraveler/hexo-theme-hiker" target="_blank">Hexo-theme-hiker</a> </p>
	      <p id="copyRightEn">Copyright &copy; 2017 - 2023 Keep It Simple And Stupid All Rights Reserved.</p>
	      
	      
    		<p class="busuanzi_uv">
				访客数 : <span id="busuanzi_value_site_uv"></span> |  
				访问量 : <span id="busuanzi_value_site_pv"></span>
		    </p>
  		   
		</div>

		
  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");
    var allheader = document.getElementById("allheader");

    wrapdiv.style.minHeight = document.body.offsetHeight + "px";
    if (allheader != null) {
      contentdiv.style.minHeight = document.body.offsetHeight - allheader.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    } else {
      contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    }
</script>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/categories" class="mobile-nav-link">Categories</a>
  
    <a href="/tags" class="mobile-nav-link">Tags</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav> -->
    

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>




<script src="/js/scripts.js"></script>





  
<script src="/js/dialog.js"></script>









	<div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>



	<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
	</script>






  </div>

  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="myModalLabel">设置</h2>
      </div>
      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">


      <div class="modal-body">
          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" onclick="javascript:setFontSize();" aria-expanded="true" aria-controls="collapseOne">
              正文字号大小
            </a>
          </div>
          <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
          <div class="panel-body">
            您已调整页面字体大小
          </div>
        </div>
      


          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" onclick="javascript:setBackground();" aria-expanded="true" aria-controls="collapseTwo">
              夜间护眼模式
            </a>
        </div>
          <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
          <div class="panel-body">
            夜间模式已经开启，再次单击按钮即可关闭 
          </div>
        </div>

        <div>
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="true" aria-controls="collapseThree">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;关 于&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
        </div>
         <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
          <div class="panel-body">
            Keep It Simple And Stupid
          </div>
          <div class="panel-body">
            Copyright © 2023 CAO XIAN LIANG All Rights Reserved.
          </div>
        </div>
      </div>


      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <div class="modal-footer">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
      </div>
    </div>
  </div>
</div>
  
  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
  
    <a id="menu-switch"><i class="fa fa-bars fa-lg"></i></a>
  
</body>
</html>